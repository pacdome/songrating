<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUSICBASE.EXE - Music Database v1.3</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=MS+Sans+Serif&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'MS Sans Serif', 'Tahoma', sans-serif;
            font-size: 11px;
            background: #c0c0c0;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0,0,0,.1) 2px, rgba(0,0,0,.1) 4px);
            min-height: 100vh;
            overflow-x: auto;
        }
        
        .window {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            margin: 20px;
            min-height: calc(100vh - 40px);
        }
        
        .title-bar {
            background: linear-gradient(90deg, #0080ff 0%, #0040ff 100%);
            color: white;
            padding: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 11px;
        }
        
        .title-text {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .window-icon {
            width: 16px;
            height: 16px;
            background: #ffff00;
            border: 1px solid #000;
            display: inline-block;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .control-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            font-size: 8px;
            text-align: center;
            line-height: 12px;
            cursor: pointer;
        }
        
        .control-btn:active {
            border: 1px inset #c0c0c0;
        }
        
        .menu-bar {
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            padding: 2px;
            display: flex;
            gap: 10px;
        }
        
        .menu-item {
            padding: 2px 8px;
            cursor: pointer;
            border: 1px solid transparent;
        }
        
        .menu-item:hover {
            border: 1px outset #c0c0c0;
        }
        
        .toolbar {
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            padding: 3px;
            display: flex;
            align-items: center;
            gap: 3px;
            flex-wrap: wrap;
        }
        
        .tool-btn {
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
            min-height: 20px;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .tool-btn:active {
            border: 1px inset #c0c0c0;
        }
        
        .tool-btn:hover {
            background: #d0d0d0;
        }
        
        .separator {
            width: 1px;
            height: 20px;
            background: #808080;
            margin: 0 2px;
        }
        
        .search-group {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
        }
        
        .search-input {
            font-family: inherit;
            font-size: 11px;
            padding: 1px 3px;
            border: 1px inset #c0c0c0;
            background: white;
            width: 150px;
        }
        
        .content-area {
            display: flex;
            height: calc(100vh - 140px);
        }
        
        .sidebar {
            width: 200px;
            background: #c0c0c0;
            border-right: 1px solid #808080;
            padding: 5px;
        }
        
        .group-box {
            border: 1px inset #c0c0c0;
            margin-bottom: 8px;
            background: #c0c0c0;
        }
        
        .group-title {
            background: #c0c0c0;
            padding: 2px 5px;
            font-weight: bold;
            font-size: 10px;
            border-bottom: 1px solid #808080;
        }
        
        .group-content {
            padding: 5px;
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            margin-bottom: 2px;
        }
        
        .filter-item {
            margin-bottom: 3px;
            font-size: 10px;
        }
        
        .filter-item input[type="checkbox"] {
            margin-right: 5px;
        }
        
        .main-content {
            flex: 1;
            background: white;
            overflow: auto;
        }
        
        .list-header {
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            display: grid;
            grid-template-columns: 30px 200px 150px 80px 80px 100px 1fr;
            font-weight: bold;
            font-size: 10px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .header-cell {
            padding: 3px 5px;
            border-right: 1px solid #808080;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-cell:hover {
            background: #d0d0d0;
        }
        
        .sort-arrow {
            font-size: 8px;
            margin-left: 3px;
        }
        
        .album-row {
            display: grid;
            grid-template-columns: 30px 200px 150px 80px 80px 100px 1fr;
            border-bottom: 1px solid #e0e0e0;
            font-size: 11px;
            cursor: pointer;
            background: white;
        }
        
        .album-row:hover {
            background: #e0e0ff;
        }
        
        .album-row.selected {
            background: #0080ff;
            color: white;
        }
        
        .cell {
            padding: 2px 5px;
            border-right: 1px solid #e0e0e0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            align-items: center;
        }
        
        .cell-number {
            text-align: center;
            justify-content: center;
        }
        
        .rating-cell {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .rating-number {
            font-weight: bold;
            min-width: 25px;
        }
        
        .rating-bar {
            display: flex;
            gap: 1px;
        }
        
        .rating-block {
            width: 4px;
            height: 8px;
            background: #e0e0e0;
            border: 1px solid #808080;
        }
        
        .rating-block.filled { background: #00ff00; }
        .rating-block.filled.high { background: #ffff00; }
        .rating-block.filled.max { background: #ff00ff; }
        
        .tracks-panel {
            display: none;
            background: #f0f0f0;
            border-top: 1px solid #808080;
            grid-column: 1 / -1;
        }
        
        .tracks-panel.show {
            display: block;
        }
        
        .tracks-header {
            background: #d0d0d0;
            padding: 3px 8px;
            font-weight: bold;
            font-size: 10px;
            border-bottom: 1px solid #808080;
        }
        
        .tracks-list {
            padding: 5px 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .track-item {
            display: grid;
            grid-template-columns: 20px 1fr 40px 30px;
            gap: 8px;
            padding: 1px 0;
            font-size: 10px;
            align-items: center;
            border-bottom: 1px dotted #c0c0c0;
        }
        
        .track-number {
            text-align: center;
            color: #808080;
        }
        
        .track-name.favorite {
            font-weight: bold;
            color: #0000ff;
        }
        
        .track-name.interlude {
            font-style: italic;
            color: #808080;
        }
        
        .track-rating {
            text-align: center;
            font-weight: bold;
        }
        
        .track-icons {
            text-align: center;
            font-size: 8px;
        }
        
        .status-bar {
            background: #c0c0c0;
            border-top: 1px solid #808080;
            padding: 2px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
        }
        
        .status-left {
            display: flex;
            gap: 10px;
        }
        
        .status-panel {
            border: 1px inset #c0c0c0;
            padding: 1px 5px;
            background: white;
        }
        
        .progressbar {
            border: 1px inset #c0c0c0;
            width: 100px;
            height: 16px;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0080ff 0%, #0040ff 100%);
            width: 65%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pixel-icon {
            width: 12px;
            height: 12px;
            background: #ffff00;
            border: 1px solid #000;
            display: inline-block;
            margin-right: 3px;
        }
        
        .comment-panel {
            background: #ffffcc;
            border: 1px solid #cccc00;
            margin: 5px 8px;
            padding: 5px;
            font-size: 10px;
            font-style: italic;
        }
        
        .comment-panel::before {
            content: "💬 ";
            font-style: normal;
        }
        
        @media (max-width: 768px) {
            .window { margin: 5px; }
            .list-header, .album-row {
                grid-template-columns: 25px 150px 100px 60px 80px 1fr;
            }
            .header-cell:nth-child(5), .cell:nth-child(5) { display: none; }
            .sidebar { width: 150px; }
            .search-input { width: 100px; }
            .content-area { height: calc(100vh - 120px); }
        }
    </style>
</head>
<body>
    <div class="window">
        <div class="title-bar">
            <div class="title-text">
                <span class="window-icon"></span>
                MUSICBASE.EXE - Music Database v1.3
            </div>
            <div class="window-controls">
                <div class="control-btn">_</div>
                <div class="control-btn">□</div>
                <div class="control-btn">×</div>
            </div>
        </div>
        
        <div class="menu-bar">
            <div class="menu-item">File</div>
            <div class="menu-item">Edit</div>
            <div class="menu-item">View</div>
            <div class="menu-item">Tools</div>
            <div class="menu-item">Help</div>
        </div>
        
        <div class="toolbar">
            <div class="tool-btn" onclick="executeCommand('random')">
                <span class="pixel-icon"></span>Random
            </div>
            <div class="separator"></div>
            <div class="tool-btn" onclick="executeCommand('expand-all')">Expand All</div>
            <div class="tool-btn" onclick="executeCommand('collapse-all')">Collapse</div>
            <div class="separator"></div>
            <div class="tool-btn" onclick="executeCommand('sort-rating')">By Rating</div>
            <div class="tool-btn" onclick="executeCommand('sort-artist')">By Artist</div>
            <div class="tool-btn" onclick="executeCommand('sort-year')">By Year</div>
            <div class="separator"></div>
            <div class="search-group">
                <label>Search:</label>
                <input type="text" class="search-input" id="searchInput" placeholder="Type to filter..." onkeyup="handleSearch(event)">
            </div>
        </div>
        
        <div class="content-area">
            <div class="sidebar">
                <div class="group-box">
                    <div class="group-title">DATABASE STATS</div>
                    <div class="group-content">
                        <div class="stats-item">
                            <span>Total Albums:</span>
                            <span id="totalAlbums">0</span>
                        </div>
                        <div class="stats-item">
                            <span>Avg Rating:</span>
                            <span id="avgRating">0.0</span>
                        </div>
                        <div class="stats-item">
                            <span>Total Tracks:</span>
                            <span id="totalTracks">0</span>
                        </div>
                        <div class="stats-item">
                            <span>Showing:</span>
                            <span id="showingCount">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="group-box">
                    <div class="group-title">QUICK FILTERS</div>
                    <div class="group-content">
                        <div class="filter-item">
                            <input type="checkbox" id="filter90s" onchange="applyFilters()">
                            <label for="filter90s">90s Albums</label>
                        </div>
                        <div class="filter-item">
                            <input type="checkbox" id="filter2000s" onchange="applyFilters()">
                            <label for="filter2000s">2000s Albums</label>
                        </div>
                        <div class="filter-item">
                            <input type="checkbox" id="filterHighRated" onchange="applyFilters()">
                            <label for="filterHighRated">High Rated (8+)</label>
                        </div>
                        <div class="filter-item">
                            <input type="checkbox" id="filterFavorites" onchange="applyFilters()">
                            <label for="filterFavorites">Has Favorites</label>
                        </div>
                    </div>
                </div>
                
                <div class="group-box">
                    <div class="group-title">SYSTEM INFO</div>
                    <div class="group-content">
                        <div class="stats-item">
                            <span>Memory:</span>
                            <span id="memUsage">42MB</span>
                        </div>
                        <div class="stats-item">
                            <span>CPU:</span>
                            <span>12%</span>
                        </div>
                        <div class="stats-item">
                            <span>Uptime:</span>
                            <span id="uptime">00:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <div class="list-header">
                    <div class="header-cell cell-number">#</div>
                    <div class="header-cell" onclick="sortBy('artist')">
                        Artist <span class="sort-arrow" id="sort-artist"></span>
                    </div>
                    <div class="header-cell" onclick="sortBy('album')">
                        Album <span class="sort-arrow" id="sort-album"></span>
                    </div>
                    <div class="header-cell" onclick="sortBy('year')">
                        Year <span class="sort-arrow" id="sort-year"></span>
                    </div>
                    <div class="header-cell" onclick="sortBy('tracks')">
                        Tracks <span class="sort-arrow" id="sort-tracks"></span>
                    </div>
                    <div class="header-cell" onclick="sortBy('rating')">
                        Rating <span class="sort-arrow" id="sort-rating">▼</span>
                    </div>
                    <div class="header-cell">Comment</div>
                </div>
                
                <div id="albumList"></div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-left">
                <div class="status-panel">Ready</div>
                <div class="status-panel">Records: <span id="statusRecords">0</span></div>
                <div class="progressbar">
                    <div class="progress-fill"></div>
                </div>
            </div>
            <div>Last Updated: <span id="lastUpdate"></span></div>
        </div>
    </div>

    <script>
        let albums = [];
        let currentAlbums = [];
        let currentSort = 'rating-desc';
        let expandedAlbums = new Set();
        let selectedAlbum = null;
        let startTime = Date.now();

        // Sample data for demo - replace with your actual albums.json loading
        const sampleAlbums = [
            {
                artist: "Radiohead",
                album: "OK Computer",
                year: 1997,
                comment: "Meisterwerk des Alternative Rock",
                songs: [
                    { name: "Airbag", rating: 8.5, favorite: false, interlude: false },
                    { name: "Paranoid Android", rating: 9.5, favorite: true, interlude: false },
                    { name: "Subterranean Homesick Alien", rating: 7.8, favorite: false, interlude: false },
                    { name: "Exit Music", rating: 9.0, favorite: true, interlude: false },
                    { name: "Let Down", rating: 8.8, favorite: false, interlude: false },
                    { name: "Karma Police", rating: 9.2, favorite: true, interlude: false }
                ]
            },
            {
                artist: "Nirvana",
                album: "Nevermind",
                year: 1991,
                comment: "Grunge-Klassiker",
                songs: [
                    { name: "Smells Like Teen Spirit", rating: 9.0, favorite: true, interlude: false },
                    { name: "In Bloom", rating: 8.2, favorite: false, interlude: false },
                    { name: "Come As You Are", rating: 8.7, favorite: false, interlude: false },
                    { name: "Breed", rating: 7.5, favorite: false, interlude: false },
                    { name: "Lithium", rating: 8.9, favorite: true, interlude: false }
                ]
            },
            {
                artist: "Daft Punk",
                album: "Discovery",
                year: 2001,
                comment: "Electronic Perfection",
                songs: [
                    { name: "One More Time", rating: 9.1, favorite: true, interlude: false },
                    { name: "Aerodynamic", rating: 8.6, favorite: false, interlude: false },
                    { name: "Digital Love", rating: 8.9, favorite: true, interlude: false },
                    { name: "Harder Better Faster Stronger", rating: 9.3, favorite: true, interlude: false },
                    { name: "Crescendolls", rating: 7.8, favorite: false, interlude: false }
                ]
            }
        ];

        async function loadAlbumsFromFile() {
            try {
                const response = await fetch('albums.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.warn('Could not load albums.json, using sample data:', error);
                return sampleAlbums;
            }
        }

        async function initializeDatabase() {
            const albumsData = await loadAlbumsFromFile();
            albums = albumsData;
            currentAlbums = [...albums];
            
            sortAlbums();
            displayAlbums();
            updateStats();
            updateLastUpdate();
        }

        function calculateAverageRating(songs) {
            const nonInterludeSongs = songs.filter(song => !song.interlude);
            if (nonInterludeSongs.length === 0) return 0;
            const sum = nonInterludeSongs.reduce((acc, song) => acc + song.rating, 0);
            return (sum / nonInterludeSongs.length).toFixed(1);
        }

        function createRatingBlocks(rating) {
            const blocks = [];
            const normalizedRating = Math.round(parseFloat(rating));
            
            for (let i = 1; i <= 10; i++) {
                const filled = i <= normalizedRating;
                let className = 'rating-block';
                if (filled) {
                    className += ' filled';
                    if (i >= 9) className += ' max';
                    else if (i >= 7) className += ' high';
                }
                blocks.push(`<div class="${className}"></div>`);
            }
            
            return blocks.join('');
        }

        function displayAlbums() {
            const albumList = document.getElementById('albumList');
            albumList.innerHTML = '';

            currentAlbums.forEach((album, index) => {
                const avgRating = calculateAverageRating(album.songs);
                const isExpanded = expandedAlbums.has(index);
                const isSelected = selectedAlbum === index;
                
                const albumDiv = document.createElement('div');
                
                const tracksHtml = album.songs.map((song, trackIndex) => `
                    <div class="track-item">
                        <span class="track-number">${trackIndex + 1}</span>
                        <span class="track-name ${song.favorite ? 'favorite' : ''} ${song.interlude ? 'interlude' : ''}">
                            ${song.name}
                        </span>
                        <span class="track-rating">${song.rating}</span>
                        <span class="track-icons">
                            ${song.favorite ? '★' : ''}
                            ${song.interlude ? 'i' : ''}
                        </span>
                    </div>
                `).join('');
                
                albumDiv.innerHTML = `
                    <div class="album-row ${isSelected ? 'selected' : ''}" onclick="selectAlbum(${index})">
                        <div class="cell cell-number">${index + 1}</div>
                        <div class="cell">${album.artist}</div>
                        <div class="cell">${album.album}</div>
                        <div class="cell cell-number">${album.year}</div>
                        <div class="cell cell-number">${album.songs.length}</div>
                        <div class="cell rating-cell">
                            <span class="rating-number">${avgRating}</span>
                            <div class="rating-bar">${createRatingBlocks(avgRating)}</div>
                        </div>
                        <div class="cell">${album.comment ? album.comment.substring(0, 30) + '...' : ''}</div>
                    </div>
                    <div class="tracks-panel ${isExpanded ? 'show' : ''}" id="tracks-${index}">
                        <div class="tracks-header">♪ TRACKLIST - ${album.artist.toUpperCase()} - ${album.album.toUpperCase()}</div>
                        <div class="tracks-list">
                            ${tracksHtml}
                            ${album.comment ? `<div class="comment-panel">${album.comment}</div>` : ''}
                        </div>
                    </div>
                `;
                
                albumList.appendChild(albumDiv);
            });
        }

        function selectAlbum(index) {
            selectedAlbum = selectedAlbum === index ? null : index;
            if (selectedAlbum !== null) {
                toggleAlbum(index);
            }
            displayAlbums();
        }

        function toggleAlbum(index) {
            if (expandedAlbums.has(index)) {
                expandedAlbums.delete(index);
            } else {
                expandedAlbums.add(index);
            }
        }

        function executeCommand(command) {
            const input = document.getElementById('searchInput');
            
            switch(command) {
                case 'sort-rating':
                    currentSort = currentSort === 'rating-desc' ? 'rating-asc' : 'rating-desc';
                    break;
                case 'sort-artist':
                    currentSort = currentSort === 'artist-asc' ? 'artist-desc' : 'artist-asc';
                    break;
                case 'sort-year':
                    currentSort = currentSort === 'year-asc' ? 'year-desc' : 'year-asc';
                    break;
                case 'expand-all':
                    currentAlbums.forEach((_, index) => expandedAlbums.add(index));
                    displayAlbums();
                    return;
                case 'collapse-all':
                    expandedAlbums.clear();
                    selectedAlbum = null;
                    displayAlbums();
                    return;
                case 'random':
                    showRandomAlbum();
                    return;
                case 'reset':
                    input.value = '';
                    currentAlbums = [...albums];
                    expandedAlbums.clear();
                    selectedAlbum = null;
                    currentSort = 'rating-desc';
                    clearFilters();
                    break;
            }
            
            sortAlbums();
            displayAlbums();
            updateStats();
            updateSortArrows();
        }

        function sortBy(criteria) {
            const newSort = currentSort.startsWith(criteria) 
                ? (currentSort.endsWith('asc') ? criteria + '-desc' : criteria + '-asc')
                : criteria + '-desc';
            
            currentSort = newSort;
            sortAlbums();
            displayAlbums();
            updateSortArrows();
        }

        function sortAlbums() {
            const [criteria, order] = currentSort.split('-');
            
            currentAlbums.sort((a, b) => {
                let comparison = 0;
                
                switch(criteria) {
                    case 'artist':
                        comparison = a.artist.localeCompare(b.artist);
                        break;
                    case 'album':
                        comparison = a.album.localeCompare(b.album);
                        break;
                    case 'year':
                        comparison = a.year - b.year;
                        break;
                    case 'tracks':
                        comparison = a.songs.length - b.songs.length;
                        break;
                    case 'rating':
                        const avgA = parseFloat(calculateAverageRating(a.songs));
                        const avgB = parseFloat(calculateAverageRating(b.songs));
                        comparison = avgA - avgB;
                        break;
                }
                
                return order === 'desc' ? -comparison : comparison;
            });
        }

        function updateSortArrows() {
            document.querySelectorAll('.sort-arrow').forEach(arrow => arrow.textContent = '');
            
            const [criteria, order] = currentSort.split('-');
            const arrowElement = document.getElementById(`sort-${criteria}`);
            if (arrowElement) {
                arrowElement.textContent = order === 'desc' ? '▼' : '▲';
            }
        }

        function handleSearch(event) {
            searchAlbums();
        }

        function searchAlbums() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            currentAlbums = albums.filter(album => 
                album.album.toLowerCase().includes(searchTerm) ||
                album.artist.toLowerCase().includes(searchTerm) ||
                album.songs.some(song => song.name.toLowerCase().includes(searchTerm)) ||
                (album.comment && album.comment.toLowerCase().includes(searchTerm))
            );
            
            applyFilters();
            expandedAlbums.clear();
            selectedAlbum = null;
            sortAlbums();
            displayAlbums();
            updateStats();
        }

        function applyFilters() {
            let filteredAlbums = [...albums];
            
            // Apply search first
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredAlbums = filteredAlbums.filter(album => 
                    album.album.toLowerCase().includes(search
