<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VINYL.NET - Record Collection Browser v2.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier Prime', 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff41;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 25% 25%, #003300 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, #001100 0%, transparent 50%),
                linear-gradient(45deg, #000000 25%, transparent 25%),
                linear-gradient(-45deg, #000000 25%, transparent 25%);
            background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
            animation: backgroundShift 30s linear infinite;
        }
        
        @keyframes backgroundShift {
            0% { background-position: 0% 0%, 0% 0%, 0px 0px, 10px 10px; }
            100% { background-position: 100% 100%, -100% -100%, 20px 20px, 30px 30px; }
        }
        
        .browser-window {
            max-width: 1200px;
            margin: 20px auto;
            background: #2a2a2a;
            border: 3px solid #666;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        
        .browser-header {
            background: linear-gradient(135deg, #4a4a4a 0%, #2a2a2a 100%);
            padding: 8px 15px;
            border-bottom: 2px solid #666;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .browser-dots {
            display: flex;
            gap: 5px;
        }
        
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .dot.red { background: #ff6b6b; }
        .dot.yellow { background: #ffd93d; }
        .dot.green { background: #6bcf7f; }
        
        .url-bar {
            flex: 1;
            background: #1a1a1a;
            border: 2px inset #666;
            padding: 4px 8px;
            color: #00ff41;
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            border-radius: 3px;
        }
        
        .vinyl-header {
            background: linear-gradient(45deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #00ff41;
            position: relative;
            overflow: hidden;
        }
        
        .vinyl-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 65, 0.1) 2px,
                rgba(0, 255, 65, 0.1) 4px
            );
            animation: scanlines 3s linear infinite;
        }
        
        @keyframes scanlines {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }
        
        .main-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5em;
            font-weight: 900;
            color: #00ff41;
            text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            margin-bottom: 10px;
            letter-spacing: 3px;
            position: relative;
            z-index: 2;
        }
        
        .subtitle {
            font-size: 14px;
            color: #88ff88;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
        }
        
        .control-panel {
            background: #1e1e1e;
            border-bottom: 2px solid #333;
            padding: 15px;
            display: grid;
            grid-template-columns: 200px 1fr 200px;
            gap: 20px;
            align-items: center;
        }
        
        .vinyl-player {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .vinyl-disc {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #1a1a1a 20%, #333 40%, #1a1a1a 42%, #666 43%, #1a1a1a 100%);
            border-radius: 50%;
            border: 2px solid #00ff41;
            position: relative;
            animation: spin 3s linear infinite;
            cursor: pointer;
        }
        
        .vinyl-disc::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background: #00ff41;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .vinyl-controls {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .control-btn {
            background: #333;
            border: 2px outset #666;
            color: #00ff41;
            padding: 2px 8px;
            font-family: inherit;
            font-size: 10px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .control-btn:hover {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 10px #00ff41;
        }
        
        .control-btn:active {
            border: 2px inset #666;
        }
        
        .search-console {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #0a0a0a;
            border: 2px inset #333;
            padding: 8px;
            border-radius: 5px;
        }
        
        .console-prompt {
            color: #ffff00;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .search-input {
            background: transparent;
            border: none;
            color: #00ff41;
            font-family: inherit;
            font-size: 12px;
            flex: 1;
            outline: none;
            caret-color: #00ff41;
        }
        
        .search-input::placeholder {
            color: #666;
        }
        
        .cassette-counter {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cassette {
            width: 80px;
            height: 50px;
            background: linear-gradient(45deg, #333 0%, #555 50%, #333 100%);
            border: 2px solid #666;
            border-radius: 3px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
        }
        
        .cassette-reel {
            width: 18px;
            height: 18px;
            background: #1a1a1a;
            border: 1px solid #00ff41;
            border-radius: 50%;
            position: relative;
        }
        
        .cassette-reel::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: #00ff41;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .counter-display {
            background: #0a0a0a;
            border: 1px inset #333;
            padding: 2px 8px;
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            color: #ff4444;
            text-align: center;
            min-width: 60px;
        }
        
        .filter-tabs {
            background: #1e1e1e;
            border-bottom: 1px solid #333;
            display: flex;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: #00ff41 #1e1e1e;
        }
        
        .filter-tab {
            background: #2a2a2a;
            border: none;
            color: #888;
            padding: 8px 15px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-right: 1px solid #333;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .filter-tab:hover {
            background: #333;
            color: #00ff41;
        }
        
        .filter-tab.active {
            background: #00ff41;
            color: #000;
            font-weight: bold;
        }
        
        .content-area {
            display: flex;
            min-height: 500px;
        }
        
        .sidebar {
            width: 250px;
            background: #1a1a1a;
            border-right: 2px solid #333;
            padding: 15px;
        }
        
        .info-panel {
            background: #0a0a0a;
            border: 2px inset #333;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        
        .info-header {
            background: #00ff41;
            color: #000;
            padding: 5px 10px;
            font-weight: bold;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-content {
            padding: 10px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 11px;
        }
        
        .info-value {
            color: #ffff00;
            font-weight: bold;
        }
        
        .equalizer {
            display: flex;
            gap: 3px;
            justify-content: center;
            margin: 10px 0;
        }
        
        .eq-bar {
            width: 4px;
            background: #333;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }
        
        .eq-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #ff4444 0%, #ffff00 50%, #00ff41 100%);
            animation: equalizer 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes equalizer {
            from { height: 20%; }
            to { height: 90%; }
        }
        
        .eq-bar:nth-child(odd) .eq-fill { animation-delay: 0.1s; }
        .eq-bar:nth-child(3n) .eq-fill { animation-delay: 0.2s; }
        .eq-bar:nth-child(4n) .eq-fill { animation-delay: 0.3s; }
        
        .main-content {
            flex: 1;
            background: #0f0f0f;
            overflow-y: auto;
            max-height: 500px;
        }
        
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            padding: 15px;
        }
        
        .album-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .album-card:hover {
            border-color: #00ff41;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.5);
            transform: translateY(-2px);
        }
        
        .album-card.expanded {
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }
        
        .album-header {
            padding: 12px;
            border-bottom: 1px solid #333;
            position: relative;
        }
        
        .album-title {
            font-weight: bold;
            font-size: 14px;
            color: #00ff41;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .album-artist {
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .album-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
            color: #666;
        }
        
        .rating-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .rating-number {
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            font-size: 16px;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
        }
        
        .rating-bars {
            display: flex;
            gap: 1px;
        }
        
        .rating-bar {
            width: 3px;
            height: 16px;
            background: #333;
            border: 1px solid #666;
        }
        
        .rating-bar.filled { background: #00ff41; box-shadow: 0 0 5px #00ff41; }
        .rating-bar.filled.high { background: #ffff00; box-shadow: 0 0 5px #ffff00; }
        .rating-bar.filled.max { background: #ff4444; box-shadow: 0 0 5px #ff4444; }
        
        .tracks-section {
            display: none;
            background: #0a0a0a;
            border-top: 1px solid #333;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .tracks-section.show {
            display: block;
        }
        
        .tracks-header {
            background: #1a1a1a;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 11px;
            color: #ffff00;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #333;
        }
        
        .track-list {
            padding: 8px 0;
        }
        
        .track-item {
            display: grid;
            grid-template-columns: 25px 1fr 40px 20px;
            gap: 8px;
            padding: 3px 12px;
            font-size: 11px;
            align-items: center;
            border-bottom: 1px dotted #333;
        }
        
        .track-item:last-child {
            border-bottom: none;
        }
        
        .track-number {
            color: #666;
            text-align: center;
        }
        
        .track-name {
            color: #ccc;
        }
        
        .track-name.favorite {
            color: #ffff00;
            font-weight: bold;
        }
        
        .track-name.interlude {
            color: #666;
            font-style: italic;
        }
        
        .track-rating {
            color: #00ff41;
            font-weight: bold;
            text-align: center;
        }
        
        .track-icons {
            text-align: center;
            color: #ffff00;
        }
        
        .comment-section {
            background: #2a1a00;
            border: 1px solid #ff8800;
            margin: 8px 12px;
            padding: 8px;
            border-radius: 3px;
            font-size: 10px;
            color: #ffaa44;
            font-style: italic;
        }
        
        .status-bar {
            background: #1a1a1a;
            border-top: 2px solid #333;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
        }
        
        .status-left {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .light-green { background: #00ff41; }
        .light-yellow { background: #ffff00; animation-delay: 0.5s; }
        .light-red { background: #ff4444; animation-delay: 1s; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #00ff41;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 20px;
            z-index: 1000;
        }
        
        .loading-screen.show {
            display: flex;
        }
        
        .loading-text {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            letter-spacing: 3px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff41; }
            to { text-shadow: 0 0 30px #00ff41, 0 0 40px #00ff41; }
        }
        
        .loading-bar {
            width: 300px;
            height: 20px;
            border: 2px solid #00ff41;
            border-radius: 10px;
            overflow: hidden;
            background: #1a1a1a;
        }
        
        .loading-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff41 0%, #ffff00 50%, #00ff41 100%);
            width: 0%;
            animation: loading 3s ease-in-out forwards;
        }
        
        @keyframes loading {
            to { width: 100%; }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .browser-window {
                margin: 10px;
                border-radius: 5px 5px 0 0;
            }
            
            .main-title {
                font-size: 1.8em;
                letter-spacing: 1px;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }
            
            .vinyl-player {
                justify-content: center;
            }
            
            .content-area {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid #333;
            }
            
            .info-panel {
                margin-bottom: 10px;
            }
            
            .album-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }
            
            .filter-tabs {
                overflow-x: scroll;
            }
            
            .main-content {
                max-height: 400px;
            }
            
            .equalizer {
                margin: 5px 0;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00ff41;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #ffff00;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-text">INITIALIZING VINYL.NET</div>
        <div class="loading-bar">
            <div class="loading-fill"></div>
        </div>
        <div style="font-size: 12px; color: #666;">Loading record collection database...</div>
    </div>

    <div class="browser-window" id="mainWindow" style="display: none;">
        <div class="browser-header">
            <div class="browser-dots">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
            </div>
            <input type="text" class="url-bar" value="vinyl://localhost/collection/browse" readonly>
        </div>
        
        <div class="vinyl-header">
            <div class="main-title">VINYL.NET</div>
            <div class="subtitle">◄ RETRO RECORD COLLECTION BROWSER ►</div>
        </div>
        
        <div class="control-panel">
            <div class="vinyl-player">
                <div class="vinyl-disc" onclick="executeCommand('random')" title="Click to play random album"></div>
                <div class="vinyl-controls">
                    <button class="control-btn" onclick="executeCommand('sort-rating')">▲ RATING</button>
                    <button class="control-btn" onclick="executeCommand('sort-artist')">▲ ARTIST</button>
                    <button class="control-btn" onclick="executeCommand('sort-year')">▲ YEAR</button>
                </div>
            </div>
            
            <div class="search-console">
                <span class="console-prompt">SEARCH></span>
                <input type="text" class="search-input" id="searchInput" placeholder="Enter album, artist or track..." onkeyup="handleSearch(event)">
            </div>
            
            <div class="cassette-counter">
                <div class="cassette">
                    <div class="cassette-reel"></div>
                    <div class="cassette-reel"></div>
                </div>
                <div class="counter-display" id="albumCounter">000</div>
            </div>
        </div>
        
        <div class="filter-tabs">
            <button class="filter-tab active" onclick="setFilter('all')">ALL RECORDS</button>
            <button class="filter-tab" onclick="setFilter('90s')">90s CLASSICS</button>
            <button class="filter-tab" onclick="setFilter('2000s')">2000s HITS</button>
            <button class="filter-tab" onclick="setFilter('top-rated')">TOP RATED</button>
            <button class="filter-tab" onclick="setFilter('favorites')">FAVORITES</button>
            <button class="filter-tab" onclick="setFilter('recent')">RECENT ADDS</button>
        </div>
        
        <div class="content-area">
            <div class="sidebar">
                <div class="info-panel">
                    <div class="info-header">COLLECTION STATS</div>
                    <div class="info-content">
                        <div class="info-item">
                            <span>Total Albums:</span>
                            <span class="info-value" id="totalAlbums">0</span>
                        </div>
                        <div class="info-item">
                            <span>Total Tracks:</span>
                            <span class="info-value" id="totalTracks">0</span>
                        </div>
                        <div class="info-item">
                            <span>Avg Rating:</span>
                            <span class="info-value" id="avgRating">0.0</span>
                        </div>
                        <div class="info-item">
                            <span>Showing:</span>
                            <span class="info-value" id="showingCount">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-panel">
                    <div class="info-header">AUDIO LEVELS</div>
                    <div class="info-content">
                        <div class="equalizer">
                            <div class="eq-bar" style="height: 40px;"><div class="eq-fill"></div></div>
                            <div class="eq-bar" style="height: 35px;"><div class="eq-fill"></div></div>
                            <div class="eq-bar" style="height: 45px;"><div class="eq-fill"></div></div>
                            <div class="eq-bar" style="height: 38px;"><div class="eq-fill"></div></div>
                            <div class="eq-bar" style="height: 42px;"><div class="eq-fill"></div></div>
                            <div class="eq-bar" style="height: 36px;"><div class="eq-fill"></div></div>
                            <div class="eq-bar" style="height: 44px;"><div class="eq-fill"></div></div>
                            <div class="eq-bar" style="height: 40px;"><div class="eq-fill"></div></div>
                        </div>
                    </div>
                </div>
                
                <div class="info-panel">
                    <div class="info-header">SYSTEM STATUS</div>
                    <div class="info-content">
                        <div class="info-item">
                            <span>Connection:</span>
                            <span class="info-value">ONLINE</span>
                        </div>
                        <div class="info-item">
                            <span>Buffer:</span>
                            <span class="info-value" id="bufferStatus">85%</span>
                        </div>
                        <div class="info-item">
                            <span>Session:</span>
                            <span class="info-value" id="sessionTime">00:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <div class="album-grid" id="albumGrid"></div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-left">
                <div class="status-indicator">
                    <div class="status-light light-green"></div>
                    <span>DB CONNECTED</span>
                </div>
                <div class="status-indicator">
                    <div class="status-light light-yellow"></div>
                    <span>INDEXING</span>
                </div>
                <div class="status-indicator">
                    <div class="status-light light-red"></div>
                    <span>BUFFER</span>
                </div>
            </div>
            <div>VINYL.NET v2.0 | © 1999 RetroSoft Technologies</div>
        </div>
    </div>

    <script>
        let albums = [];
        let currentAlbums = [];
        let currentSort = 'rating-desc';
        let currentFilter = 'all';
        let expandedAlbums = new Set();
        let startTime = Date.now();

        async function loadAlbumsFromFile() {
            try {
                console.log('Attempting to load albums.json...');
                const response = await fetch('albums.json');
                
                if (!response.ok) {
                    throw new Error(`Failed to load albums.json: ${response.status} ${response.statusText}`);
                }
                
                const albumsData = await response.json();
                console.log(`Successfully loaded ${albumsData.length} albums from albums.json`);
                
                // Validate data structure
                if (!Array.isArray(albumsData) || albumsData.length === 0) {
                    throw new Error('albums.json is empty or not an array');
                }
                
                // Validate album structure
                const validAlbums = albumsData.filter(album => {
                    return album.artist && album.album && album.year && 
                           Array.isArray(album.songs) && album.songs.length > 0;
                });
                
                if (validAlbums.length !== albumsData.length) {
                    console.warn(`Some albums had invalid structure. Using ${validAlbums.length} of ${albumsData.length} albums.`);
                }
                
                if (validAlbums.length === 0) {
                    throw new Error('No valid albums found in albums.json');
                }
                
                return validAlbums;
                
            } catch (error) {
                console.error('Could not load albums.json:', error.message);
                showError('albums.json file not found or invalid. Please place a valid albums.json file in the same directory.');
                return [];
            }
        }

        function showError(message) {
            const albumGrid = document.getElementById('albumGrid');
            albumGrid.innerHTML = `
                <div style="
                    grid-column: 1 / -1;
                    background: linear-gradient(135deg, #2a0000 0%, #4a0000 100%);
                    border: 2px solid #ff4444;
                    border-radius: 8px;
                    padding: 30px;
                    text-align: center;
                    color: #ff6666;
                    margin: 20px;
                ">
                    <div style="font-size: 24px; margin-bottom: 15px; color: #ff4444;">⚠ DATABASE ERROR</div>
                    <div style="font-size: 14px; margin-bottom: 20px; line-height: 1.5;">${message}</div>
                    <div style="font-size: 12px; color: #ff8888; background: #1a0000; padding: 15px; border-radius: 5px; font-family: 'Courier Prime', monospace;">
                        Expected file structure:<br><br>
                        [<br>
                        &nbsp;&nbsp;{<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"artist": "Artist Name",<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"album": "Album Name",<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"year": 2000,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"comment": "Optional comment",<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"songs": [<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name": "Song Name",<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"rating": 8.5,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"favorite": false,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"interlude": false<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;]<br>
                        &nbsp;&nbsp;}<br>
                        ]
                    </div>
                </div>
            `;
        }

        function showDataSourceNotification(message) {
            // Create a temporary notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff8800;
                color: #000;
                padding: 10px 15px;
                border: 2px solid #ffaa00;
                border-radius: 5px;
                font-family: inherit;
                font-size: 12px;
                z-index: 1001;
                max-width: 300px;
                box-shadow: 0 0 15px rgba(255, 136, 0, 0.5);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        async function initializeDatabase() {
            showLoading();
            
            // Show loading for at least 2 seconds for better UX
            const startTime = Date.now();
            
            try {
                const albumsData = await loadAlbumsFromFile();
                albums = albumsData;
                currentAlbums = [...albums];
                
                // Ensure minimum loading time
                const elapsed = Date.now() - startTime;
                const remainingTime = Math.max(0, 2000 - elapsed);
                
                setTimeout(() => {
                    if (albums.length > 0) {
                        sortAlbums();
                        displayAlbums();
                        updateStats();
                        console.log(`Successfully loaded ${albums.length} albums from albums.json`);
                    } else {
                        updateStats();
                    }
                    hideLoading();
                }, remainingTime);
                
            } catch (error) {
                console.error('Failed to initialize database:', error);
                setTimeout(() => {
                    hideLoading();
                    showDataSourceNotification('Error loading albums.json');
                    updateStats();
                }, 2000);
            }
        }

        function showLoading() {
            document.getElementById('loadingScreen').classList.add('show');
            document.getElementById('mainWindow').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingScreen').classList.remove('show');
            document.getElementById('mainWindow').style.display = 'block';
        }

        function calculateAverageRating(songs) {
            const nonInterludeSongs = songs.filter(song => !song.interlude);
            if (nonInterludeSongs.length === 0) return 0;
            const sum = nonInterludeSongs.reduce((acc, song) => acc + song.rating, 0);
            return (sum / nonInterludeSongs.length).toFixed(1);
        }

        function createRatingBars(rating) {
            const bars = [];
            const normalizedRating = Math.round(parseFloat(rating));
            
            for (let i = 1; i <= 10; i++) {
                const filled = i <= normalizedRating;
                let className = 'rating-bar';
                if (filled) {
                    className += ' filled';
                    if (i >= 9) className += ' max';
                    else if (i >= 7) className += ' high';
                }
                bars.push(`<div class="${className}"></div>`);
            }
            
            return bars.join('');
        }

        function displayAlbums() {
            const albumGrid = document.getElementById('albumGrid');
            albumGrid.innerHTML = '';

            currentAlbums.forEach((album, index) => {
                const avgRating = calculateAverageRating(album.songs);
                const isExpanded = expandedAlbums.has(index);
                
                const albumCard = document.createElement('div');
                albumCard.className = `album-card ${isExpanded ? 'expanded' : ''}`;
                albumCard.onclick = () => toggleAlbum(index);
                
                const tracksHtml = album.songs.map((song, trackIndex) => `
                    <div class="track-item">
                        <span class="track-number">${trackIndex + 1}</span>
                        <span class="track-name ${song.favorite ? 'favorite' : ''} ${song.interlude ? 'interlude' : ''}">
                            ${song.name}
                        </span>
                        <span class="track-rating">${song.rating}</span>
                        <span class="track-icons">
                            ${song.favorite ? '★' : ''}
                            ${song.interlude ? '◊' : ''}
                        </span>
                    </div>
                `).join('');
                
                albumCard.innerHTML = `
                    <div class="album-header">
                        <div class="album-title">${album.album}</div>
                        <div class="album-artist">by ${album.artist}</div>
                        <div class="album-meta">
                            <span>${album.year} • ${album.songs.length} tracks</span>
                            <div class="rating-display">
                                <span class="rating-number">${avgRating}</span>
                                <div class="rating-bars">${createRatingBars(avgRating)}</div>
                            </div>
                        </div>
                    </div>
                    <div class="tracks-section ${isExpanded ? 'show' : ''}" id="tracks-${index}">
                        <div class="tracks-header">♫ TRACK LISTING</div>
                        <div class="track-list">
                            ${tracksHtml}
                        </div>
                        ${album.comment ? `<div class="comment-section">📼 ${album.comment}</div>` : ''}
                    </div>
                `;
                
                albumGrid.appendChild(albumCard);
            });

            updateAlbumCounter();
        }

        function toggleAlbum(index) {
            if (expandedAlbums.has(index)) {
                expandedAlbums.delete(index);
            } else {
                expandedAlbums.add(index);
            }
            displayAlbums();
        }

        function executeCommand(command) {
            const input = document.getElementById('searchInput');
            
            switch(command) {
                case 'sort-rating':
                    currentSort = currentSort === 'rating-desc' ? 'rating-asc' : 'rating-desc';
                    break;
                case 'sort-artist':
                    currentSort = currentSort === 'artist-asc' ? 'artist-desc' : 'artist-asc';
                    break;
                case 'sort-year':
                    currentSort = currentSort === 'year-asc' ? 'year-desc' : 'year-asc';
                    break;
                case 'expand-all':
                    currentAlbums.forEach((_, index) => expandedAlbums.add(index));
                    displayAlbums();
                    return;
                case 'collapse-all':
                    expandedAlbums.clear();
                    displayAlbums();
                    return;
                case 'random':
                    showRandomAlbum();
                    return;
                case 'reset':
                    input.value = '';
                    currentAlbums = [...albums];
                    expandedAlbums.clear();
                    currentSort = 'rating-desc';
                    currentFilter = 'all';
                    setFilter('all');
                    break;
            }
            
            sortAlbums();
            displayAlbums();
            updateStats();
        }

        function setFilter(filter) {
            currentFilter = filter;
            
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            applyFilter();
        }

        function applyFilter() {
            let filteredAlbums = [...albums];
            
            // Apply search first
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredAlbums = filteredAlbums.filter(album => 
                    album.album.toLowerCase().includes(searchTerm) ||
                    album.artist.toLowerCase().includes(searchTerm) ||
                    album.songs.some(song => song.name.toLowerCase().includes(searchTerm)) ||
                    (album.comment && album.comment.toLowerCase().includes(searchTerm))
                );
            }
            
            // Apply filter
            switch(currentFilter) {
                case '90s':
                    filteredAlbums = filteredAlbums.filter(album => album.year >= 1990 && album.year < 2000);
                    break;
                case '2000s':
                    filteredAlbums = filteredAlbums.filter(album => album.year >= 2000 && album.year < 2010);
                    break;
                case 'top-rated':
                    filteredAlbums = filteredAlbums.filter(album => 
                        parseFloat(calculateAverageRating(album.songs)) >= 8.5
                    );
                    break;
                case 'favorites':
                    filteredAlbums = filteredAlbums.filter(album => 
                        album.songs.some(song => song.favorite)
                    );
                    break;
                case 'recent':
                    filteredAlbums = filteredAlbums.filter(album => album.year >= 2020);
                    break;
                case 'all':
                default:
                    break;
            }
            
            currentAlbums = filteredAlbums;
            expandedAlbums.clear();
            sortAlbums();
            displayAlbums();
            updateStats();
        }

        function handleSearch(event) {
            applyFilter();
        }

        function sortAlbums() {
            const [criteria, order] = currentSort.split('-');
            
            currentAlbums.sort((a, b) => {
                let comparison = 0;
                
                switch(criteria) {
                    case 'artist':
                        comparison = a.artist.localeCompare(b.artist);
                        break;
                    case 'album':
                        comparison = a.album.localeCompare(b.album);
                        break;
                    case 'year':
                        comparison = a.year - b.year;
                        break;
                    case 'rating':
                        const avgA = parseFloat(calculateAverageRating(a.songs));
                        const avgB = parseFloat(calculateAverageRating(b.songs));
                        comparison = avgA - avgB;
                        break;
                }
                
                return order === 'desc' ? -comparison : comparison;
            });
        }

        function showRandomAlbum() {
            if (currentAlbums.length === 0) return;
            
            const randomIndex = Math.floor(Math.random() * currentAlbums.length);
            expandedAlbums.clear();
            expandedAlbums.add(randomIndex);
            
            displayAlbums();
            
            // Scroll to album
            setTimeout(() => {
                const albumCards = document.querySelectorAll('.album-card');
                if (albumCards[randomIndex]) {
                    albumCards[randomIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }

        function updateStats() {
            const totalTracks = albums.reduce((sum, album) => sum + album.songs.length, 0);
            const totalRating = albums.reduce((sum, album) => {
                return sum + parseFloat(calculateAverageRating(album.songs));
            }, 0);
            const avgRating = albums.length > 0 ? (totalRating / albums.length).toFixed(1) : '0.0';
            
            document.getElementById('totalAlbums').textContent = albums.length;
            document.getElementById('totalTracks').textContent = totalTracks;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('showingCount').textContent = currentAlbums.length;
        }

        function updateAlbumCounter() {
            const count = currentAlbums.length.toString().padStart(3, '0');
            document.getElementById('albumCounter').textContent = count;
        }

        function updateSessionTime() {
            const elapsed = Date.now() - startTime;
            const minutes = Math.floor(elapsed / 60000).toString().padStart(2, '0');
            const seconds = Math.floor((elapsed % 60000) / 1000).toString().padStart(2, '0');
            
            document.getElementById('sessionTime').textContent = `${minutes}:${seconds}`;
        }

        function updateBufferStatus() {
            const buffer = Math.floor(Math.random() * 30) + 70; // 70-100%
            document.getElementById('bufferStatus').textContent = `${buffer}%`;
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            initializeDatabase();
            
            // Update session time every second
            setInterval(updateSessionTime, 1000);
            
            // Update buffer status every 3 seconds
            setInterval(updateBufferStatus, 3000);
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                    document.getElementById('searchInput').select();
                }
                
                if (e.key === 'Escape') {
                    expandedAlbums.clear();
                    displayAlbums();
                }
                
                if (e.key === 'F5') {
                    e.preventDefault();
                    executeCommand('random');
                }
                
                if (e.key === ' ') {
                    e.preventDefault();
                    executeCommand('random');
                }
            });
            
            // Focus search input after loading
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 3500);
        });
    </script>
</body>
</html>
