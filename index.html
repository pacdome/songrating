<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Meine Musikliste</title>
    <style>
        body {
            background: white;
            color: black;
            font-family: 'Courier New', monospace;
            margin: 20px;
            line-height: 1.4;
            font-size: 13px;
            margin-bottom: 120px;
            position: relative;
        }

        /* Subtle retro pattern background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(0,0,0,0.02) 1px, transparent 0);
            background-size: 20px 20px;
            pointer-events: none;
            z-index: -1;
        }
        
        h1 {
            font-size: 20px;
            border-bottom: 2px solid black;
            padding-bottom: 3px;
            margin-bottom: 8px;
            position: relative;
        }

        /* Vintage computer terminal cursor effect */
        h1::after {
            content: '█';
            animation: blink 1s infinite;
            color: #333;
            margin-left: 5px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        h3.intro {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin: 8px 0 15px 0;
            font-weight: normal;
            padding: 8px 12px;
            background: linear-gradient(45deg, transparent, rgba(0,0,0,0.03), transparent);
            border-left: 3px solid #ddd;
        }
        
        h2 {
            font-size: 14px;
            margin: 15px 0 5px 0;
            font-weight: bold;
            cursor: pointer;
            padding: 3px;
            transition: all 0.2s ease;
            position: relative;
        }
        
        h2:hover {
            background: #f0f0f0;
            transform: translateX(2px);
        }

        /* Retro ASCII-style decorative elements */
        h2::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid #ccc;
            border-top: 3px solid transparent;
            border-bottom: 3px solid transparent;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        h2:hover::after {
            opacity: 1;
        }
        
        h2::before {
            content: "▶ ";
            font-size: 10px;
            margin-right: 5px;
            color: #666;
        }
        
        h2.expanded::before {
            content: "▼ ";
        }

        .medal {
            font-size: 16px;
            margin-right: 5px;
        }
        
        h3 {
            font-size: 12px;
            margin: 2px 0 2px 25px;
            font-weight: normal;
            display: none;
        }
        
        h3.show {
            display: block;
        }
        
        .album-comment {
            font-size: 12px;
            margin: 8px 0 2px 25px;
            font-style: italic;
            color: #666;
            display: none;
            border-top: 1px solid #ddd;
            padding-top: 6px;
            word-wrap: break-word;
            max-width: 50%;
        }

        .album-comment.show {
            display: block;
        }
        
        /* Hue-based color system from red to green */
        .rating-0-1 { color: hsl(0, 60%, 45%); }      /* Red */
        .rating-1-2 { color: hsl(15, 60%, 45%); }     /* Red-Orange */
        .rating-2-3 { color: hsl(30, 60%, 45%); }     /* Orange */
        .rating-3-4 { color: hsl(45, 60%, 40%); }     /* Yellow-Orange */
        .rating-4-5 { color: hsl(60, 50%, 35%); }     /* Yellow */
        .rating-5-6 { color: hsl(75, 50%, 35%); }     /* Yellow-Green */
        .rating-6-7 { color: hsl(90, 45%, 35%); }     /* Light Green */
        .rating-7-8 { color: hsl(105, 50%, 35%); }    /* Green */
        .rating-8-9 { color: hsl(120, 55%, 35%); }    /* Pure Green */
        .rating-9-10 { color: hsl(135, 60%, 35%); }   /* Dark Green */
        
        .rating-10 {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff);
            background-size: 300% 300%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow 2s ease-in-out infinite;
            font-weight: bold;
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @media (max-width: 768px) {
            body {
                margin: 8px;
                font-size: 11px;
                margin-bottom: 140px;
            }
            
            h1 {
                font-size: 16px;
                margin-bottom: 6px;
            }

            h3.intro {
                font-size: 10px;
                margin: 3px 0 10px 0;
            }
            
            h2 {
                font-size: 12px;
                padding: 8px 6px;
                margin: 6px 0 3px 0;
            }
            
            h3 {
                font-size: 10px;
                margin-left: 8px;
                padding: 4px 3px;
            }
            
            .album-comment {
                font-size: 10px;
                max-width: 80%;
                margin-left: 8px;
            }
            
            .controls {
                padding: 6px 0;
                margin: 6px 0;
            }
            
            .legend {
                bottom: 10px;
                right: 10px;
                font-size: 9px;
                padding: 6px 8px;
            }
            
            .pagination {
                font-size: 10px;
                margin: 15px 0;
            }
        }
        
        select, input[type="text"] {
            border: 1px solid #ccc;
            padding: 4px 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: white;
        }
        
        select {
            cursor: pointer;
        }
        
        button {
            border: 1px solid #ccc;
            background: #f8f8f8;
            padding: 4px 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 1px;
            cursor: pointer;
        }
        
        button:hover {
            background: #e0e0e0;
        }
        
        p {
            display: inline;
            font-style: italic;
        }
        
        .controls {
            margin: 10px 0;
            padding: 12px;
            border: 1px solid #ddd;
            background: #f8f8f8;
            font-size: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        /* Subtle animated background pattern */
        .controls::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 3s infinite;
            z-index: 0;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .search-group, .sort-group {
            display: flex;
            align-items: center;
            gap: 5px;
            position: relative;
            z-index: 1;
        }

        .search-group label, .sort-group label {
            font-weight: bold;
            white-space: nowrap;
        }
        
        .album-container {
            margin-bottom: 15px;
        }

        .pagination {
            text-align: center;
            margin: 20px 0;
            font-size: 12px;
        }

        .pagination button {
            margin: 0 2px;
            padding: 6px 10px;
            background: #f8f8f8;
            border: 1px solid #ddd;
        }

        .pagination button.active {
            background: #333;
            color: white;
            border-color: #333;
        }

        .pagination button:disabled {
            background: #f0f0f0;
            color: #999;
            cursor: not-allowed;
        }

        .pagination button:hover:not(:disabled):not(.active) {
            background: #e8e8e8;
        }
        
        .legend {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ccc;
            padding: 10px 12px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 3px;
            border-radius: 3px;
        }

        .legend div {
            margin: 0;
        }

        .legend .interlude-note {
            font-size: 9px;
            font-style: italic;
            color: #888;
            margin-left: 5px;
        }

        .legend .dark-mode-toggle {
            position: static;
            background: transparent;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 4px 0;
            align-self: center;
            margin-top: 5px;
        }

        .legend .dark-mode-toggle:hover {
            background: rgba(0,0,0,0.1);
            border-radius: 3px;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        body.dark-mode::before {
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
        }

        body.dark-mode h1 {
            border-bottom-color: #555;
        }

        body.dark-mode h1::after {
            color: #ccc;
        }

        body.dark-mode h3.intro {
            color: #999;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);
            border-left-color: #555;
        }

        body.dark-mode h2 {
            color: #e0e0e0;
        }

        body.dark-mode h2:hover {
            background: #333;
        }

        body.dark-mode h3 {
            color: #e0e0e0;
        }

        body.dark-mode .album-comment {
            color: #aaa;
            border-color: #444;
        }

        body.dark-mode .album-container {
        }

        body.dark-mode select, 
        body.dark-mode input[type="text"] {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode button {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode button:hover {
            background: #444;
        }

        body.dark-mode .pagination button.active {
            background: #666;
            border-color: #666;
        }

        body.dark-mode .controls {
            background: #2a2a2a;
            border-color: #444;
        }

        body.dark-mode .legend {
            background: rgba(26, 26, 26, 0.95);
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .legend .dark-mode-toggle:hover {
            background: rgba(255,255,255,0.1);
        }

        body.dark-mode .legend .interlude-note {
            color: #666;
        }

        /* Dark mode color adjustments for better visibility */
        body.dark-mode .rating-0-1 { color: hsl(0, 70%, 60%); }
        body.dark-mode .rating-1-2 { color: hsl(15, 70%, 60%); }
        body.dark-mode .rating-2-3 { color: hsl(30, 70%, 60%); }
        body.dark-mode .rating-3-4 { color: hsl(45, 70%, 65%); }
        body.dark-mode .rating-4-5 { color: hsl(60, 70%, 70%); }
        body.dark-mode .rating-5-6 { color: hsl(75, 70%, 65%); }
        body.dark-mode .rating-6-7 { color: hsl(90, 70%, 60%); }
        body.dark-mode .rating-7-8 { color: hsl(105, 70%, 60%); }
        body.dark-mode .rating-8-9 { color: hsl(120, 70%, 60%); }
        body.dark-mode .rating-9-10 { color: hsl(135, 70%, 60%); }
    </style>
</head>
<body>
    <h1>Meine Musikliste</h1>
    
    <h3 class="intro">Willkommen zu meiner persönlichen Musiksammlung. Hier findest du meine bewerteten Alben mit allen Songs und Kommentaren.</h3>
    
    <div class="controls">
        <div class="search-group">
            <label>Suche:</label>
            <input type="text" id="searchInput" placeholder="Albumname..." onkeyup="searchAlbums()">
            <button onclick="searchAlbums()">Suchen</button>
        </div>
        <div class="sort-group">
            <label>Sortierung:</label>
            <select id="sortSelect" onchange="sortAlbums()">
                <option value="rating-desc">Bewertung (Hoch → Niedrig)</option>
                <option value="rating-asc">Bewertung (Niedrig → Hoch)</option>
                <option value="artist-asc">Artist (A → Z)</option>
                <option value="artist-desc">Artist (Z → A)</option>
                <option value="album-asc">Album (A → Z)</option>
                <option value="album-desc">Album (Z → A)</option>
                <option value="year-asc">Jahr (Alt → Neu)</option>
                <option value="year-desc">Jahr (Neu → Alt)</option>
            </select>
        </div>
    </div>
    
    <div id="albumList"></div>

    <div class="pagination" id="pagination"></div>

    <script>
        let albums = [];
        let currentAlbums = [];
        let currentPage = 1;
        const albumsPerPage = 20;

        // Lade Albums aus externer JSON-Datei
        async function loadAlbums() {
            try {
                const response = await fetch('albums.json');
                albums = await response.json();
                currentAlbums = [...albums];
                sortAlbums(); // Standard-Sortierung nach Bewertung
                displayAlbums();
                updatePagination();
            } catch (error) {
                console.error('Fehler beim Laden der Albums:', error);
                // Fallback: leeres Array
                albums = [];
                currentAlbums = [];
                displayAlbums();
                updatePagination();
            }
        }

        function calculateAverageRating(songs) {
            // Filtere Interludes aus der Bewertung heraus
            const nonInterludeSongs = songs.filter(song => !song.interlude);
            if (nonInterludeSongs.length === 0) return 0;
            const sum = nonInterludeSongs.reduce((acc, song) => acc + song.rating, 0);
            return (sum / nonInterludeSongs.length).toFixed(1);
        }

        function getRatingClass(rating) {
            if (rating == 10) return 'rating-10';
            if (rating >= 9) return 'rating-9-10';
            if (rating >= 8) return 'rating-8-9';
            if (rating >= 7) return 'rating-7-8';
            if (rating >= 6) return 'rating-6-7';
            if (rating >= 5) return 'rating-5-6';
            if (rating >= 4) return 'rating-4-5';
            if (rating >= 3) return 'rating-3-4';
            if (rating >= 2) return 'rating-2-3';
            if (rating >= 1) return 'rating-1-2';
            return 'rating-0-1';
        }

        function getMedal(rank) {
            switch(rank) {
                case 1: return '<span class="medal">🥇</span>';
                case 2: return '<span class="medal">🥈</span>';
                case 3: return '<span class="medal">🥉</span>';
                default: return '';
            }
        }

        function displayAlbums() {
            const albumList = document.getElementById('albumList');
            albumList.innerHTML = '';

            const startIndex = (currentPage - 1) * albumsPerPage;
            const endIndex = startIndex + albumsPerPage;
            const pageAlbums = currentAlbums.slice(startIndex, endIndex);

            pageAlbums.forEach((album, pageIndex) => {
                const albumIndex = startIndex + pageIndex;
                const avgRating = calculateAverageRating(album.songs);
                const albumDiv = document.createElement('div');
                albumDiv.className = 'album-container';
                
                // Berechne Ranking für Medaillen (nur bei Standard-Rating-Sortierung)
                let medal = '';
                if (document.getElementById('sortSelect').value === 'rating-desc') {
                    medal = getMedal(albumIndex + 1);
                }
                
                albumDiv.innerHTML = `
                    <h2 onclick="toggleAlbum(${albumIndex})" id="album-${albumIndex}">
                        ${medal}${album.artist} - ${album.album} (${album.year}) | ${avgRating}/10
                    </h2>
                    ${album.songs.map((song, songIndex) => `
                        <h3 id="song-${albumIndex}-${songIndex}">
                            ${song.name} | <span class="${getRatingClass(song.rating)}">${song.rating}/10</span>${song.favorite ? ' ★' : ''}${song.interlude ? ' i' : ''}
                        </h3>
                    `).join('')}
                    ${album.comment ? `<div class="album-comment" id="comment-${albumIndex}">${album.comment}</div>` : ''}
                `;
                
                albumList.appendChild(albumDiv);
            });
        }

        function updatePagination() {
            const totalPages = Math.ceil(currentAlbums.length / albumsPerPage);
            const pagination = document.getElementById('pagination');
            
            // Zeige Pagination auch bei wenigen Alben für Demo-Zwecke
            if (totalPages <= 1 && currentAlbums.length < 10) {
                pagination.innerHTML = `<div style="font-style: italic; color: #666; text-align: center; margin: 20px 0;">Alle ${currentAlbums.length} Alben werden angezeigt</div>`;
                return;
            }

            let html = '';
            
            // Previous button
            html += `<button onclick="changePage(${currentPage - 1})" ${currentPage <= 1 ? 'disabled' : ''}>‹</button>`;
            
            // Page numbers
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                html += `<button onclick="changePage(1)">1</button>`;
                if (startPage > 2) {
                    html += `<span style="margin: 0 5px;">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span style="margin: 0 5px;">...</span>`;
                }
                html += `<button onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            html += `<button onclick="changePage(${currentPage + 1})" ${currentPage >= totalPages ? 'disabled' : ''}>›</button>`;
            
            pagination.innerHTML = html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(currentAlbums.length / albumsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            displayAlbums();
            updatePagination();
            window.scrollTo(0, 0);
        }

        function toggleAlbum(albumIndex) {
            const albumHeader = document.getElementById(`album-${albumIndex}`);
            const isExpanded = albumHeader.classList.contains('expanded');
            
            // Toggle der expanded Klasse für das Album-Header
            albumHeader.classList.toggle('expanded');
            
            // Toggle der show Klasse für alle Songs des Albums
            const album = currentAlbums[albumIndex];
            album.songs.forEach((song, songIndex) => {
                const songElement = document.getElementById(`song-${albumIndex}-${songIndex}`);
                if (songElement) {
                    if (isExpanded) {
                        songElement.classList.remove('show');
                    } else {
                        songElement.classList.add('show');
                    }
                }
            });
            
            // Toggle der show Klasse für den Albumkommentar
            const commentElement = document.getElementById(`comment-${albumIndex}`);
            if (commentElement) {
                if (isExpanded) {
                    commentElement.classList.remove('show');
                } else {
                    commentElement.classList.add('show');
                }
            }
        }

        function searchAlbums() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            currentAlbums = albums.filter(album => 
                album.album.toLowerCase().includes(searchTerm)
            );
            currentPage = 1;
            sortAlbums();
            displayAlbums();
            updatePagination();
        }

        function sortAlbums() {
            const sortValue = document.getElementById('sortSelect').value;
            const [criteria, order] = sortValue.split('-');
            
            currentAlbums.sort((a, b) => {
                let comparison = 0;
                
                switch(criteria) {
                    case 'artist':
                        comparison = a.artist.localeCompare(b.artist);
                        break;
                    case 'album':
                        comparison = a.album.localeCompare(b.album);
                        break;
                    case 'year':
                        comparison = a.year - b.year;
                        break;
                    case 'rating':
                        const avgA = parseFloat(calculateAverageRating(a.songs));
                        const avgB = parseFloat(calculateAverageRating(b.songs));
                        comparison = avgA - avgB; // Für korrekte Sortierung
                        break;
                    default:
                        return 0;
                }
                
                return order === 'desc' ? -comparison : comparison;
            });
            
            currentPage = 1;
            displayAlbums();
            updatePagination();
        }

        // Dark Mode Funktionalität
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            const btn = document.getElementById('darkModeBtn');
            
            if (isDarkMode) {
                btn.textContent = '☀️';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                btn.textContent = '🌙';
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        // Dark Mode beim Laden der Seite anwenden falls gespeichert
        function initDarkMode() {
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'enabled') {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeBtn').textContent = '☀️';
            }
        }

        // Beim Laden der Seite Albums laden, Dark Mode initialisieren und anzeigen
        document.addEventListener('DOMContentLoaded', () => {
            initDarkMode();
            loadAlbums();
        });

        /*
        ANLEITUNG ZUM HINZUFÜGEN NEUER ALBEN:

        Bearbeite die Datei "albums.json" und füge neue Alben in folgendem Format hinzu:

        {
            "artist": "KÜNSTLERNAME",
            "album": "ALBUMNAME",
            "year": JAHR,
            "comment": "ALBUM GESAMTKOMMENTAR (OPTIONAL)",
            "songs": [
                {"name": "SONGNAME1", "rating": BEWERTUNG_1_BIS_10, "favorite": false, "interlude": false},
                {"name": "SONGNAME2", "rating": BEWERTUNG_1_BIS_10, "favorite": true, "interlude": false},
                {"name": "SONGNAME3", "rating": BEWERTUNG_1_BIS_10, "favorite": false, "interlude": true}
            ]
        },

        SYMBOLE:
        - favorite: true = ausgefüllter Stern ★ (Lieblingssong)
        - favorite: false = kein Stern
        - interlude: true = i (Interlude - wird nicht in Albumbewertung einbezogen)
        - interlude: false = kein i

        BEDIENUNG:
        - Klick auf Albumname um Songs ein-/auszuklappen
        - Pfeil zeigt an ob Album ausgeklappt (▼) oder eingeklappt (▶) ist
        - Interludes werden automatisch aus der Durchschnittsbewertung des Albums ausgeschlossen
        - Albumkommentar erscheint nach der Songliste wenn vorhanden
        - Die besten 3 Alben erhalten Medaillen (🥇🥈🥉) bei Sortierung nach Bewertung
        */
    </script>
    
    <div class="legend">
        <div>★ = Lieblingssong</div>
        <div>i = Interlude <span class="interlude-note">(Geht nicht in Bewertung ein)</span></div>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeBtn">🌙</button>
    </div>
</body>
</html>
