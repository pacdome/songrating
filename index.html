<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Meine Musikliste</title>
    <style>
        body {
            background: white;
            color: black;
            font-family: 'Courier New', monospace;
            margin: 20px;
            line-height: 1.3;
            font-size: 13px;
            margin-bottom: 120px;
        }
        
        h1 {
            font-size: 20px;
            border-bottom: 2px solid black;
            padding-bottom: 3px;
            margin-bottom: 15px;
        }
        
        h2 {
            font-size: 14px;
            margin: 15px 0 5px 0;
            font-weight: bold;
            cursor: pointer;
            padding: 3px;
        }
        
        h2:hover {
            background: #f0f0f0;
        }
        
        h2::before {
            content: "â–¶ ";
            font-size: 10px;
            margin-right: 5px;
        }
        
        h2.expanded::before {
            content: "â–¼ ";
        }
        
        h3 {
            font-size: 12px;
            margin: 2px 0 2px 25px;
            font-weight: normal;
            display: none;
        }
        
        h3.show {
            display: block;
        }
        
        .album-comment {
            font-size: 12px;
            margin: 8px 0 2px 25px;
            font-style: italic;
            color: #666;
            display: none;
            border-top: 1px solid #ddd;
            padding-top: 6px;
            word-wrap: break-word;
            max-width: 50%;
        }

        .album-comment.show {
            display: block;
        }
        
        .rating-0-3 {
            color: #c66;
        }
        
        .rating-3-5 {
            color: #cc8844;
        }
        
        .rating-5-7 {
            color: #b5a02e;
        }
        
        .rating-7-9-5 {
            color: #4a9;
        }
        
        .rating-10 {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff);
            background-size: 300% 300%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow 2s ease-in-out infinite;
            font-weight: bold;
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @media (max-width: 768px) {
            body {
                margin: 8px;
                font-size: 11px;
                margin-bottom: 140px;
            }
            
            h1 {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            h2 {
                font-size: 12px;
                padding: 6px 3px;
            }
            
            h3 {
                font-size: 10px;
                margin-left: 8px;
                padding: 4px 3px;
            }
            
            .album-comment {
                font-size: 10px;
                max-width: 80%;
            }
            
            input[type="text"] {
                font-size: 14px;
                padding: 6px 8px;
            }
            
            .button-row {
                display: flex;
                flex-wrap: wrap;
                gap: 4px;
                justify-content: flex-start;
            }
            
            .button-row button {
                flex: 0 0 auto;
                min-width: unset;
                width: auto;
                margin: 0;
                padding: 6px 8px;
                font-size: 10px;
                min-height: unset;
            }
            
            .controls {
                padding: 8px 0;
                margin: 8px 0;
            }
            
            .legend {
                bottom: 10px;
                right: 10px;
                font-size: 9px;
                padding: 6px 8px;
            }
            
            .legend .dark-mode-toggle {
                font-size: 14px;
            }
        }
        
        input[type="text"] {
            border: 1px solid #ccc;
            padding: 3px 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        button {
            border: 1px solid #ccc;
            background: #f8f8f8;
            padding: 3px 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 1px;
        }
        
        button:hover {
            background: #e0e0e0;
        }
        
        p {
            display: inline;
            font-style: italic;
        }
        
        .controls {
            margin: 10px 0;
            padding: 8px 0;
            border-top: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
            font-size: 12px;
        }
        
        .album-container {
            margin-bottom: 10px;
        }
        
        .legend {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            padding: 8px 12px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .legend div {
            margin: 0;
        }

        .legend .dark-mode-toggle {
            position: static;
            background: transparent;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 2px 0;
            align-self: center;
        }

        .legend .dark-mode-toggle:hover {
            background: rgba(0,0,0,0.1);
            border-radius: 3px;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        body.dark-mode h1 {
            border-bottom-color: #555;
        }

        body.dark-mode h2:hover {
            background: #333;
        }

        body.dark-mode .album-comment {
            color: #aaa;
            border-top-color: #444;
        }

        body.dark-mode input[type="text"] {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode button {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode button:hover {
            background: #444;
        }

        body.dark-mode .controls {
            border-top-color: #444;
            border-bottom-color: #444;
        }

        body.dark-mode .legend {
            background: rgba(26, 26, 26, 0.9);
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .legend .dark-mode-toggle:hover {
            background: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <h1>Meine Musikliste</h1>
    
    <div class="controls">
        <input type="text" id="searchInput" placeholder="Suche nach Albumname..." onkeyup="searchAlbums()">
        <button onclick="searchAlbums()">Suchen</button>
        <div class="button-row">
            <button onclick="sortBy('artist')">A-Z Artist</button>
            <button onclick="sortBy('album')">A-Z Album</button>
            <button onclick="sortBy('year')">Jahr</button>
            <button onclick="sortBy('rating')">Bewertung</button>
        </div>
    </div>
    
    <div id="albumList"></div>

    <script>
        let albums = [];
        let currentAlbums = [];

        // Lade Albums aus externer JSON-Datei
        async function loadAlbums() {
            try {
                const response = await fetch('albums.json');
                albums = await response.json();
                currentAlbums = [...albums];
                displayAlbums();
            } catch (error) {
                console.error('Fehler beim Laden der Albums:', error);
                // Fallback: leeres Array
                albums = [];
                currentAlbums = [];
                displayAlbums();
            }
        }

        function calculateAverageRating(songs) {
            // Filtere Interludes aus der Bewertung heraus
            const nonInterludeSongs = songs.filter(song => !song.interlude);
            if (nonInterludeSongs.length === 0) return 0;
            const sum = nonInterludeSongs.reduce((acc, song) => acc + song.rating, 0);
            return (sum / nonInterludeSongs.length).toFixed(1);
        }

        function getRatingClass(rating) {
            if (rating >= 0 && rating < 3) return 'rating-0-3';
            if (rating >= 3 && rating < 5) return 'rating-3-5';
            if (rating >= 5 && rating < 7) return 'rating-5-7';
            if (rating >= 7 && rating < 9.5) return 'rating-7-9-5';
            if (rating >= 9.5) return 'rating-10';
            return '';
        }

        function displayAlbums() {
            const albumList = document.getElementById('albumList');
            albumList.innerHTML = '';

            currentAlbums.forEach((album, albumIndex) => {
                const avgRating = calculateAverageRating(album.songs);
                const albumDiv = document.createElement('div');
                albumDiv.className = 'album-container';
                
                albumDiv.innerHTML = `
                    <h2 onclick="toggleAlbum(${albumIndex})" id="album-${albumIndex}">
                        ${album.artist} - ${album.album} (${album.year}) (${avgRating}/10)
                    </h2>
                    ${album.songs.map((song, songIndex) => `
                        <h3 id="song-${albumIndex}-${songIndex}">
                            ${song.name} | <span class="${getRatingClass(song.rating)}">${song.rating}/10</span>${song.favorite ? ' â˜…' : ''}${song.interlude ? ' â€ ' : ''}
                        </h3>
                    `).join('')}
                    ${album.comment ? `<div class="album-comment" id="comment-${albumIndex}">${album.comment}</div>` : ''}
                `;
                
                albumList.appendChild(albumDiv);
            });
        }

        function toggleAlbum(albumIndex) {
            const albumHeader = document.getElementById(`album-${albumIndex}`);
            const isExpanded = albumHeader.classList.contains('expanded');
            
            // Toggle der expanded Klasse fÃ¼r das Album-Header
            albumHeader.classList.toggle('expanded');
            
            // Toggle der show Klasse fÃ¼r alle Songs des Albums
            currentAlbums[albumIndex].songs.forEach((song, songIndex) => {
                const songElement = document.getElementById(`song-${albumIndex}-${songIndex}`);
                if (songElement) {
                    if (isExpanded) {
                        songElement.classList.remove('show');
                    } else {
                        songElement.classList.add('show');
                    }
                }
            });
            
            // Toggle der show Klasse fÃ¼r den Albumkommentar
            const commentElement = document.getElementById(`comment-${albumIndex}`);
            if (commentElement) {
                if (isExpanded) {
                    commentElement.classList.remove('show');
                } else {
                    commentElement.classList.add('show');
                }
            }
        }

        function searchAlbums() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            currentAlbums = albums.filter(album => 
                album.album.toLowerCase().includes(searchTerm)
            );
            displayAlbums();
        }

        function sortBy(criteria) {
            currentAlbums.sort((a, b) => {
                switch(criteria) {
                    case 'artist':
                        return a.artist.localeCompare(b.artist);
                    case 'album':
                        return a.album.localeCompare(b.album);
                    case 'year':
                        return a.year - b.year;
                    case 'rating':
                        const avgA = calculateAverageRating(a.songs);
                        const avgB = calculateAverageRating(b.songs);
                        return avgB - avgA; // HÃ¶chste Bewertung zuerst
                    default:
                        return 0;
                }
            });
            displayAlbums();
        }

        // Dark Mode FunktionalitÃ¤t
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            const btn = document.getElementById('darkModeBtn');
            
            if (isDarkMode) {
                btn.textContent = 'â˜€ï¸';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                btn.textContent = 'ðŸŒ™';
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        // Dark Mode beim Laden der Seite anwenden falls gespeichert
        function initDarkMode() {
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'enabled') {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeBtn').textContent = 'â˜€ï¸';
            }
        }

        // Beim Laden der Seite Albums laden, Dark Mode initialisieren und anzeigen
        document.addEventListener('DOMContentLoaded', () => {
            initDarkMode();
            loadAlbums();
        });

        /*
        ANLEITUNG ZUM HINZUFÃœGEN NEUER ALBEN:

        Bearbeite die Datei "albums.json" und fÃ¼ge neue Alben in folgendem Format hinzu:

        {
            "artist": "KÃœNSTLERNAME",
            "album": "ALBUMNAME",
            "year": JAHR,
            "comment": "ALBUM GESAMTKOMMENTAR (OPTIONAL)",
            "songs": [
                {"name": "SONGNAME1", "rating": BEWERTUNG_1_BIS_10, "favorite": false, "interlude": false},
                {"name": "SONGNAME2", "rating": BEWERTUNG_1_BIS_10, "favorite": true, "interlude": false},
                {"name": "SONGNAME3", "rating": BEWERTUNG_1_BIS_10, "favorite": false, "interlude": true}
            ]
        },

        Beispiel:
        {
            "artist": "Led Zeppelin",
            "album": "Led Zeppelin IV",
            "year": 1971,
            "comment": "Ein zeitloses Meisterwerk des Rock",
            "songs": [
                {"name": "Black Dog", "rating": 8, "favorite": false, "interlude": false},
                {"name": "Rock and Roll", "rating": 7, "favorite": false, "interlude": false},
                {"name": "Stairway to Heaven", "rating": 10, "favorite": true, "interlude": false},
                {"name": "Instrumental Break", "rating": 6, "favorite": false, "interlude": true}
            ]
        },

        SYMBOLE:
        - favorite: true = ausgefÃ¼llter Stern â˜… (Lieblingssong)
        - favorite: false = kein Stern
        - interlude: true = Kreuz â€  (Interlude - wird nicht in Albumbewertung einbezogen)
        - interlude: false = kein Kreuz

        BEDIENUNG:
        - Klick auf Albumname um Songs ein-/auszuklappen
        - Pfeil zeigt an ob Album ausgeklappt (â–¼) oder eingeklappt (â–¶) ist
        - Interludes werden automatisch aus der Durchschnittsbewertung des Albums ausgeschlossen
        - Albumkommentar erscheint nach der Songliste wenn vorhanden
        */
    </script>
    
    <div class="legend">
        <div>â˜… = Lieblingssong</div>
        <div>â€  = Interlude</div>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeBtn">ðŸŒ™</button>
    </div>
</body>
</html>
