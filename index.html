<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musikarchiv.exe - Notepad</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Perfect+DOS+VGA+437&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: #008080;
            font-family: 'Perfect DOS VGA 437', 'MS Sans Serif', sans-serif;
            font-size: 11px;
            overflow: hidden;
            height: 100vh;
        }
        
        .desktop {
            position: relative;
            width: 100%;
            height: 100vh;
            background: #008080;
            background-image: 
                radial-gradient(circle at 25% 25%, #008b8b 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, #006666 0%, transparent 50%);
        }
        
        .window {
            position: absolute;
            top: 50px;
            left: 50px;
            right: 50px;
            bottom: 90px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 2px 2px 0 #000;
        }
        
        .title-bar {
            height: 18px;
            background: linear-gradient(90deg, #000080 0%, #0000ff 100%);
            display: flex;
            align-items: center;
            padding: 2px;
            color: white;
            font-size: 11px;
            position: relative;
        }
        
        .title-icon {
            width: 14px;
            height: 14px;
            background: #ffff00;
            margin-right: 4px;
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: #000;
        }
        
        .title-text {
            flex-grow: 1;
            font-weight: bold;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .window-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            cursor: pointer;
            color: #000;
        }
        
        .window-btn:active {
            border: 1px inset #c0c0c0;
        }
        
        .menu-bar {
            height: 20px;
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 4px;
        }
        
        .menu-item {
            padding: 4px 8px;
            cursor: pointer;
            border: 1px solid transparent;
        }
        
        .menu-item:hover {
            background: #316ac5;
            color: white;
            border: 1px solid #000080;
        }
        
        .content-area {
            flex: 1;
            background: white;
            margin: 2px;
            border: 1px inset #c0c0c0;
            display: flex;
            overflow: hidden;
        }
        
        .text-area {
            flex: 1;
            background: white;
            padding: 4px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            line-height: 1.2;
            overflow-y: auto;
            position: relative;
        }
        
        .scrollbar {
            width: 16px;
            background: #c0c0c0;
            border-left: 1px solid #808080;
            display: flex;
            flex-direction: column;
        }
        
        .scroll-btn {
            height: 16px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 8px;
        }
        
        .scroll-btn:active {
            border: 1px inset #c0c0c0;
        }
        
        .scroll-track {
            flex: 1;
            background: #c0c0c0;
            position: relative;
        }
        
        .scroll-thumb {
            width: 14px;
            height: 30px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            cursor: pointer;
            position: absolute;
            top: 0;
        }
        
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: #c0c0c0;
            border-top: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 2px;
            z-index: 1000;
        }
        
        .start-btn {
            height: 26px;
            padding: 0 20px 0 6px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            position: relative;
        }
        
        .start-btn:active {
            border: 1px inset #c0c0c0;
        }
        
        .start-btn::before {
            content: "⊞";
            margin-right: 4px;
            color: #000080;
            font-size: 14px;
        }
        
        .taskbar-app {
            height: 26px;
            padding: 0 8px;
            background: #c0c0c0;
            border: 1px inset #c0c0c0;
            display: flex;
            align-items: center;
            margin-left: 4px;
            font-size: 10px;
        }
        
        .taskbar-app::before {
            content: "📄";
            margin-right: 4px;
        }
        
        .system-tray {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 4px;
        }
        
        .tray-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        
        .clock {
            padding: 0 4px;
            border: 1px inset #c0c0c0;
            font-size: 10px;
        }
        
        .album-entry {
            margin-bottom: 16px;
            font-family: 'Courier New', monospace;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
        }
        
        .album-header {
            font-weight: bold;
            margin-bottom: 4px;
            cursor: pointer;
            background: #e0e0e0;
            padding: 2px 4px;
            border: 1px solid #808080;
        }
        
        .album-header:hover {
            background: #d0d0d0;
        }
        
        .album-details {
            margin-left: 8px;
            display: none;
            font-size: 9px;
            line-height: 1.3;
        }
        
        .album-details.expanded {
            display: block;
        }
        
        .song-list {
            margin: 4px 0;
        }
        
        .song-item {
            display: flex;
            justify-content: space-between;
            padding: 1px 0;
        }
        
        .song-rating {
            min-width: 40px;
            text-align: right;
        }
        
        .rating-10 { color: #ff0000; font-weight: bold; }
        .rating-9 { color: #ff6600; font-weight: bold; }
        .rating-8 { color: #ff9900; }
        .rating-7 { color: #ffcc00; }
        .rating-6 { color: #009900; }
        .rating-5 { color: #0066cc; }
        .rating-4 { color: #6666cc; }
        .rating-3 { color: #9966cc; }
        .rating-2 { color: #cc6699; }
        .rating-1 { color: #cc3333; }
        
        .favorite::after {
            content: " ★";
            color: #ff0000;
        }
        
        .interlude {
            opacity: 0.6;
            font-style: italic;
        }
        
        .controls {
            background: #f0f0f0;
            padding: 4px;
            border-bottom: 1px solid #808080;
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 10px;
        }
        
        .control-input {
            padding: 2px 4px;
            border: 1px inset #c0c0c0;
            background: white;
            font-family: inherit;
            font-size: 10px;
        }
        
        .control-button {
            padding: 2px 8px;
            border: 1px outset #c0c0c0;
            background: #c0c0c0;
            cursor: pointer;
            font-family: inherit;
            font-size: 10px;
        }
        
        .control-button:active {
            border: 1px inset #c0c0c0;
        }
        
        .status-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 16px;
            height: 16px;
            background: #c0c0c0;
            border-top: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 4px;
            font-size: 9px;
        }
        
        .cursor {
            animation: blink 1s infinite;
            color: #000;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .window-content {
            display: flex;
            flex-direction: column;
            height: calc(100% - 18px);
        }
    </style>
</head>
<body>
    <div class="desktop">
        <div class="window">
            <div class="title-bar">
                <div class="title-icon">♪</div>
                <div class="title-text">Musikarchiv.txt - Notepad</div>
                <div class="window-controls">
                    <div class="window-btn">_</div>
                    <div class="window-btn">□</div>
                    <div class="window-btn">×</div>
                </div>
            </div>
            
            <div class="window-content">
                <div class="menu-bar">
                    <div class="menu-item">Datei</div>
                    <div class="menu-item">Bearbeiten</div>
                    <div class="menu-item">Suchen</div>
                    <div class="menu-item">Hilfe</div>
                </div>
                
                <div class="controls">
                    <label>Suchen:</label>
                    <input type="text" class="control-input" id="searchInput" placeholder="Album oder Künstler..." onkeyup="searchAlbums()">
                    
                    <label>Sortierung:</label>
                    <select class="control-input" id="sortSelect" onchange="sortAlbums()">
                        <option value="rating-desc">Bewertung (hoch-niedrig)</option>
                        <option value="rating-asc">Bewertung (niedrig-hoch)</option>
                        <option value="artist-asc">Künstler (A-Z)</option>
                        <option value="year-desc">Jahr (neu-alt)</option>
                        <option value="year-asc">Jahr (alt-neu)</option>
                    </select>
                    
                    <button class="control-button" onclick="toggleAllAlbums()">Alle aufklappen</button>
                    <button class="control-button" onclick="resetFilters()">Zurücksetzen</button>
                </div>
                
                <div class="content-area">
                    <div class="text-area" id="albumList">
                        Lade Musikarchiv...<span class="cursor">|</span>
                    </div>
                    <div class="scrollbar">
                        <div class="scroll-btn">▲</div>
                        <div class="scroll-track">
                            <div class="scroll-thumb"></div>
                        </div>
                        <div class="scroll-btn">▼</div>
                    </div>
                </div>
                
                <div class="status-line">
                    <span id="statusText">Zeile 1, Spalte 1</span>
                    <span style="margin-left: auto;" id="albumCount">0 Alben geladen</span>
                </div>
            </div>
        </div>
        
        <div class="taskbar">
            <div class="start-btn">Start</div>
            <div class="taskbar-app">Musikarchiv.txt - Notepad</div>
            <div class="system-tray">
                <div class="tray-icon">🔊</div>
                <div class="tray-icon">📧</div>
                <div class="clock" id="clock">12:34</div>
            </div>
        </div>
    </div>

    <script>
        let albums = [];
        let currentAlbums = [];
        let allExpanded = false;

        async function loadAlbums() {
            try {
                const response = await fetch('albums.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                albums = await response.json();
                
                // Entferne Duplikate basierend auf Artist und Album
                const uniqueAlbums = [];
                const seen = new Set();
                
                for (const album of albums) {
                    const key = `${album.artist}-${album.album}`;
                    if (!seen.has(key)) {
                        seen.add(key);
                        uniqueAlbums.push(album);
                    }
                }
                
                albums = uniqueAlbums;
                currentAlbums = [...albums];
                sortAlbums();
                displayAlbums();
                updateStatus();
            } catch (error) {
                console.error('Fehler beim Laden:', error);
                document.getElementById('albumList').innerHTML = 
                    `FEHLER: Kann albums.json nicht laden.\n\n` +
                    `Datei nicht gefunden oder Zugriff verweigert.\n` +
                    `Bitte überprüfen Sie den Dateipfad.<span class="cursor">|</span>`;
            }
        }

        function calculateAverageRating(songs) {
            const nonInterludeSongs = songs.filter(song => !song.interlude);
            if (nonInterludeSongs.length === 0) return 0;
            const sum = nonInterludeSongs.reduce((acc, song) => acc + song.rating, 0);
            return (sum / nonInterludeSongs.length).toFixed(1);
        }

        function getRatingClass(rating) {
            return `rating-${Math.floor(rating)}`;
        }

        function displayAlbums() {
            const albumList = document.getElementById('albumList');
            let content = '';
            
            content += `═══════════════════════════════════════════════════════════════════════════════\n`;
            content += `                            DOMES MUSIK ARCHIV v1.0                             \n`;
            content += `═══════════════════════════════════════════════════════════════════════════════\n\n`;
            
            if (currentAlbums.length === 0) {
                content += `Keine Alben gefunden.\n\n`;
            } else {
                currentAlbums.forEach((album, index) => {
                    const avgRating = calculateAverageRating(album.songs);
                    const favoriteCount = album.songs.filter(song => song.favorite).length;
                    
                    content += `[${String(index + 1).padStart(2, '0')}] `;
                    content += `${album.artist} - ${album.album} (${album.year})\n`;
                    content += `     Rating: ${avgRating}/10 | Songs: ${album.songs.length} | Favoriten: ${favoriteCount}\n`;
                    content += `     ────────────────────────────────────────────────────────────────────────\n`;
                    
                    if (document.querySelector(`[data-album="${index}"]`)?.classList.contains('expanded')) {
                        album.songs.forEach((song, songIndex) => {
                            const songNum = String(songIndex + 1).padStart(2, '0');
                            const rating = song.rating.toString().padStart(4, ' ');
                            const favorite = song.favorite ? ' ★' : '  ';
                            const interlude = song.interlude ? ' [i]' : '    ';
                            
                            content += `     ${songNum}. ${song.name.padEnd(35, '.')} ${rating}/10${favorite}${interlude}\n`;
                        });
                        
                        if (album.comment) {
                            content += `\n     KOMMENTAR:\n`;
                            content += `     ${album.comment}\n`;
                        }
                        content += `\n`;
                    }
                    
                    content += `\n`;
                });
            }
            
            content += `\n<span class="cursor">|</span>`;
            
            albumList.innerHTML = content;
            
            // Add click handlers for album headers
            addAlbumClickHandlers();
        }

        function addAlbumClickHandlers() {
            const albumList = document.getElementById('albumList');
            const lines = albumList.innerHTML.split('\n');
            let newContent = '';
            
            lines.forEach((line, lineIndex) => {
                if (line.match(/^\[[\d]{2}\]/)) {
                    const albumIndex = parseInt(line.match(/^\[(\d{2})\]/)[1]) - 1;
                    newContent += `<span class="album-header" data-album="${albumIndex}" onclick="toggleAlbum(${albumIndex})">${line}</span>\n`;
                } else {
                    newContent += line + '\n';
                }
            });
            
            albumList.innerHTML = newContent;
        }

        function toggleAlbum(index) {
            const header = document.querySelector(`[data-album="${index}"]`);
            header.classList.toggle('expanded');
            displayAlbums();
        }

        function toggleAllAlbums() {
            allExpanded = !allExpanded;
            const headers = document.querySelectorAll('.album-header');
            
            headers.forEach(header => {
                if (allExpanded) {
                    header.classList.add('expanded');
                } else {
                    header.classList.remove('expanded');
                }
            });
            
            displayAlbums();
            
            const button = event.target;
            button.textContent = allExpanded ? 'Alle zuklappen' : 'Alle aufklappen';
        }

        function searchAlbums() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            currentAlbums = albums.filter(album => 
                album.album.toLowerCase().includes(searchTerm) ||
                album.artist.toLowerCase().includes(searchTerm) ||
                album.songs.some(song => song.name.toLowerCase().includes(searchTerm))
            );
            displayAlbums();
            updateStatus();
        }

        function sortAlbums() {
            const sortValue = document.getElementById('sortSelect').value;
            const [criteria, order] = sortValue.split('-');
            
            currentAlbums.sort((a, b) => {
                let comparison = 0;
                
                switch(criteria) {
                    case 'artist':
                        comparison = a.artist.localeCompare(b.artist);
                        break;
                    case 'album':
                        comparison = a.album.localeCompare(b.album);
                        break;
                    case 'year':
                        comparison = a.year - b.year;
                        break;
                    case 'rating':
                        const avgA = parseFloat(calculateAverageRating(a.songs));
                        const avgB = parseFloat(calculateAverageRating(b.songs));
                        comparison = avgA - avgB;
                        break;
                    default:
                        return 0;
                }
                
                return order === 'desc' ? -comparison : comparison;
            });
            
            displayAlbums();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('sortSelect').value = 'rating-desc';
            currentAlbums = [...albums];
            sortAlbums();
            updateStatus();
        }

        function updateStatus() {
            document.getElementById('albumCount').textContent = `${currentAlbums.length} Alben geladen`;
            
            // Update clock
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('clock').textContent = timeString;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadAlbums();
            setInterval(updateStatus, 1000); // Update clock every second
        });

        // Window controls
        document.querySelectorAll('.window-btn').forEach((btn, index) => {
            btn.addEventListener('click', () => {
                if (index === 2) { // Close button
                    if (confirm('Möchten Sie das Musikarchiv wirklich schließen?')) {
                        document.querySelector('.window').style.display = 'none';
                    }
                } else if (index === 1) { // Maximize button
                    const window = document.querySelector('.window');
                    if (window.style.top === '0px') {
                        window.style.top = '50px';
                        window.style.left = '50px';
                        window.style.right = '50px';
                        window.style.bottom = '90px';
                    } else {
                        window.style.top = '0px';
                        window.style.left = '0px';
                        window.style.right = '0px';
                        window.style.bottom = '30px';
                    }
                } else { // Minimize button
                    document.querySelector('.window').style.display = 'none';
                    setTimeout(() => {
                        document.querySelector('.window').style.display = 'block';
                    }, 2000);
                }
            });
        });
    </script>
</body>
</html>
