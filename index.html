<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECHNICS MD-3000 PRO</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body {
            background: 
                radial-gradient(circle at 25% 25%, #1a1a1a 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, #2a2a2a 0%, transparent 50%),
                linear-gradient(135deg, #0d0d0d 0%, #1a1a1a 50%, #0d0d0d 100%);
            font-family: 'Share Tech Mono', monospace;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 0, 0.01) 2px,
                    rgba(0, 255, 0, 0.01) 4px
                );
            pointer-events: none;
            z-index: 1;
        }
        
        .device {
            width: 800px;
            height: 600px;
            background: 
                linear-gradient(145deg, #2a2a2a 0%, #1a1a1a 20%, #2a2a2a 40%, #1a1a1a 60%, #2a2a2a 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 
                0 0 100px rgba(0, 0, 0, 0.9),
                0 20px 60px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.5),
                inset 2px 2px 10px rgba(255, 255, 255, 0.05),
                inset -2px -2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
            border: 3px solid #333;
        }
        
        .device::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 22px;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 1px,
                    rgba(255, 255, 255, 0.02) 1px,
                    rgba(255, 255, 255, 0.02) 2px
                );
            pointer-events: none;
        }
        
        .top-panel {
            height: 20px;
            background: linear-gradient(90deg, #333, #444, #333);
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .top-panel::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #555, transparent);
        }
        
        .brand-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .brand {
            color: #888;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 4px;
            font-family: 'Orbitron', monospace;
            text-shadow: 
                1px 1px 0 rgba(0,0,0,0.8),
                0 0 10px rgba(136, 136, 136, 0.3);
        }
        
        .model {
            color: #666;
            font-size: 12px;
            font-weight: 400;
            letter-spacing: 2px;
            font-family: 'Orbitron', monospace;
        }
        
        .power-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .power-led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, #ff6666, #ff0000);
            box-shadow: 
                0 0 15px rgba(255, 0, 0, 0.8),
                inset 0 1px 2px rgba(255, 255, 255, 0.3),
                inset 0 -1px 2px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
            border: 1px solid #660000;
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                box-shadow: 
                    0 0 15px rgba(255, 0, 0, 0.8),
                    inset 0 1px 2px rgba(255, 255, 255, 0.3);
            }
            50% { 
                opacity: 0.4; 
                box-shadow: 
                    0 0 8px rgba(255, 0, 0, 0.4),
                    inset 0 1px 2px rgba(255, 255, 255, 0.1);
            }
        }
        
        .power-text {
            color: #666;
            font-size: 10px;
            letter-spacing: 1px;
            font-family: 'Orbitron', monospace;
        }
        
        .lcd-container {
            background: 
                linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 4px solid #2a2a2a;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 
                inset 0 4px 15px rgba(0, 0, 0, 0.8),
                inset 0 0 0 2px rgba(0, 100, 0, 0.1),
                0 2px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            height: 200px;
        }
        
        .lcd-container::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border-radius: 8px;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent 0px,
                    transparent 1px,
                    rgba(0, 255, 0, 0.02) 1px,
                    rgba(0, 255, 0, 0.02) 2px
                );
            pointer-events: none;
        }
        
        .lcd-bezel {
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 17px;
            background: linear-gradient(45deg, #333, #444, #333);
            z-index: -1;
        }
        
        .lcd-screen {
            background: 
                radial-gradient(circle at center, #0a2d0a 0%, #051505 70%, #000 100%);
            border-radius: 8px;
            padding: 20px;
            height: 100%;
            display: flex;
            align-items: center;
            position: relative;
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.9);
        }
        
        .lcd-screen::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            height: 30%;
            background: 
                linear-gradient(
                    to bottom,
                    rgba(255, 255, 255, 0.02) 0%,
                    transparent 100%
                );
            border-radius: 4px;
            pointer-events: none;
        }
        
        .display-text {
            color: #00ff41;
            font-size: 20px;
            font-weight: 400;
            letter-spacing: 1px;
            text-shadow: 
                0 0 10px rgba(0, 255, 65, 0.8),
                0 0 20px rgba(0, 255, 65, 0.4),
                0 0 30px rgba(0, 255, 65, 0.2);
            width: 100%;
            text-align: left;
            font-family: 'Share Tech Mono', monospace;
            line-height: 1.3;
            filter: blur(0.3px);
        }
        
        .cursor {
            display: inline-block;
            width: 8px;
            height: 20px;
            background: 
                linear-gradient(to bottom, #00ff41, #00cc33);
            margin-left: 2px;
            animation: blink 1s infinite;
            box-shadow: 0 0 5px rgba(0, 255, 65, 0.6);
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .controls-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .btn {
            background: 
                linear-gradient(145deg, #4a4a4a 0%, #3a3a3a 50%, #2a2a2a 100%);
            border: none;
            border-radius: 12px;
            color: #ddd;
            font-family: 'Orbitron', monospace;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 2px;
            padding: 20px 15px;
            cursor: pointer;
            box-shadow: 
                0 8px 15px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.5),
                inset 1px 0 0 rgba(255, 255, 255, 0.05),
                inset -1px 0 0 rgba(0, 0, 0, 0.3);
            transition: all 0.15s ease;
            text-transform: uppercase;
            position: relative;
            height: 80px;
            border: 2px solid #555;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 50%;
            background: 
                linear-gradient(to bottom, rgba(255, 255, 255, 0.1), transparent);
            border-radius: 8px 8px 0 0;
            pointer-events: none;
        }
        
        .btn:hover {
            background: 
                linear-gradient(145deg, #5a5a5a 0%, #4a4a4a 50%, #3a3a3a 100%);
            transform: translateY(-2px);
            box-shadow: 
                0 12px 20px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                inset 0 -1px 0 rgba(0, 0, 0, 0.5);
            color: #fff;
        }
        
        .btn:active {
            transform: translateY(4px);
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.6),
                inset 0 2px 8px rgba(0, 0, 0, 0.4);
        }
        
        .btn-primary {
            background: 
                linear-gradient(145deg, #006600 0%, #004d00 50%, #003300 100%);
            color: #00ff41;
            border-color: #008800;
        }
        
        .btn-primary::before {
            background: 
                linear-gradient(to bottom, rgba(0, 255, 65, 0.2), transparent);
        }
        
        .btn-primary:hover {
            background: 
                linear-gradient(145deg, #008800 0%, #006600 50%, #004400 100%);
            color: #44ff77;
            box-shadow: 
                0 12px 20px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(0, 255, 65, 0.3);
        }
        
        .status-panel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            padding: 15px 20px;
            background: 
                linear-gradient(90deg, #1a1a1a, #2a2a2a, #1a1a1a);
            border-radius: 10px;
            border: 2px solid #333;
            box-shadow: 
                inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .battery-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .battery {
            width: 40px;
            height: 20px;
            border: 2px solid #666;
            border-radius: 3px;
            position: relative;
            background: #000;
        }
        
        .battery::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 6px;
            bottom: 6px;
            width: 3px;
            background: #666;
            border-radius: 0 2px 2px 0;
        }
        
        .battery-fill {
            height: 100%;
            background: 
                linear-gradient(90deg, #00ff41, #00cc33);
            border-radius: 1px;
            width: 85%;
            box-shadow: 
                0 0 5px rgba(0, 255, 65, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .battery-text {
            color: #888;
            font-size: 12px;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
        }
        
        .counter-section {
            text-align: center;
        }
        
        .counter {
            color: #00ff41;
            font-size: 18px;
            font-weight: 700;
            font-family: 'Share Tech Mono', monospace;
            text-shadow: 0 0 8px rgba(0, 255, 65, 0.6);
        }
        
        .counter-label {
            color: #666;
            font-size: 10px;
            margin-top: 2px;
            font-family: 'Orbitron', monospace;
            letter-spacing: 1px;
        }
        
        .system-info {
            text-align: right;
            color: #666;
            font-size: 10px;
            font-family: 'Orbitron', monospace;
            letter-spacing: 1px;
        }
        
        .loading {
            text-align: center;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { 
                text-shadow: 
                    0 0 10px rgba(0, 255, 65, 0.8),
                    0 0 20px rgba(0, 255, 65, 0.4);
            }
            to { 
                text-shadow: 
                    0 0 20px rgba(0, 255, 65, 1),
                    0 0 30px rgba(0, 255, 65, 0.6),
                    0 0 40px rgba(0, 255, 65, 0.4);
            }
        }
        
        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
        
        .error-text {
            color: #ff4444;
            text-shadow: 
                0 0 10px rgba(255, 68, 68, 0.8),
                0 0 20px rgba(255, 68, 68, 0.4);
        }
        
        @media (max-width: 900px) {
            .device {
                width: 90vw;
                height: 80vh;
                padding: 30px;
            }
            
            .display-text {
                font-size: 16px;
            }
            
            .btn {
                font-size: 14px;
                padding: 15px 10px;
                height: 70px;
            }
            
            .controls-section {
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="device">
        <div class="top-panel"></div>
        
        <div class="brand-section">
            <div>
                <div class="brand">TECHNICS</div>
                <div class="model">MD-3000 PRO ARCHIVE UNIT</div>
            </div>
            <div class="power-indicator">
                <div class="power-led"></div>
                <div class="power-text">POWER</div>
            </div>
        </div>
        
        <div class="lcd-container">
            <div class="lcd-bezel"></div>
            <div class="lcd-screen">
                <div class="display-text" id="display">
                    <div class="loading">SYSTEM INITIALIZING</div>
                </div>
            </div>
        </div>
        
        <div class="controls-section">
            <button class="btn" onclick="navigate('prev')" id="btnPrev">◀ PREV</button>
            <button class="btn btn-primary" onclick="navigate('select')" id="btnSelect">SELECT</button>
            <button class="btn" onclick="navigate('next')" id="btnNext">NEXT ▶</button>
        </div>
        
        <div class="status-panel">
            <div class="battery-section">
                <div class="battery">
                    <div class="battery-fill"></div>
                </div>
                <div class="battery-text">85%</div>
            </div>
            <div class="counter-section">
                <div class="counter" id="counter">00/00</div>
                <div class="counter-label" id="counterLabel">INITIALIZING</div>
            </div>
            <div class="system-info">
                <div id="memoryInfo">MEMORY: 0MB</div>
                <div id="statusInfo">STATUS: BOOT</div>
            </div>
        </div>
    </div>

    <script>
        let albums = [];
        let currentIndex = 0;
        let currentView = 'startup'; // 'startup', 'menu', 'browse', 'album', 'stats', 'favorites'
        let currentAlbumIndex = 0;
        let currentSongIndex = 0;
        let currentMenuIndex = 0;
        let statsData = {};
        
        const menuItems = [
            { name: 'BROWSE ALBUMS', mode: 'browse' },
            { name: 'STATISTICS', mode: 'stats' },
            { name: 'TOP FAVORITES', mode: 'favorites' },
            { name: 'RANDOM ALBUM', mode: 'random' },
            { name: 'SYSTEM INFO', mode: 'info' }
        ];

        async function loadAlbums() {
            try {
                const response = await fetch('./albums.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                
                // Bereinige Duplikate (basierend auf Artist + Album)
                const uniqueAlbums = [];
                const seen = new Set();
                
                data.forEach(album => {
                    const key = `${album.artist}-${album.album}`;
                    if (!seen.has(key)) {
                        seen.add(key);
                        
                        // Berechne Average Rating
                        const nonInterludeSongs = album.songs.filter(song => !song.interlude);
                        if (nonInterludeSongs.length > 0) {
                            const sum = nonInterludeSongs.reduce((acc, song) => acc + song.rating, 0);
                            album.avgRating = (sum / nonInterludeSongs.length).toFixed(1);
                        } else {
                            album.avgRating = 0;
                        }
                        
                        uniqueAlbums.push(album);
                    }
                });
                
                albums = uniqueAlbums;
                calculateStats();
                showStartupScreen();
                
            } catch (error) {
                console.error('Fehler beim Laden der albums.json:', error);
                showError(`LOAD ERROR: ${error.message}`);
            }
        }

        function calculateStats() {
            const totalSongs = albums.reduce((sum, album) => sum + album.songs.length, 0);
            const totalNonInterludes = albums.reduce((sum, album) => 
                sum + album.songs.filter(song => !song.interlude).length, 0);
            const totalFavorites = albums.reduce((sum, album) => 
                sum + album.songs.filter(song => song.favorite).length, 0);
            
            const allRatings = [];
            albums.forEach(album => {
                album.songs.forEach(song => {
                    if (!song.interlude) {
                        allRatings.push(song.rating);
                    }
                });
            });
            
            const avgRating = allRatings.length > 0 
                ? (allRatings.reduce((sum, rating) => sum + rating, 0) / allRatings.length).toFixed(1)
                : 0;
            
            const topAlbum = albums.reduce((best, album) => 
                parseFloat(album.avgRating) > parseFloat(best.avgRating) ? album : best, albums[0]);
            
            statsData = {
                totalAlbums: albums.length,
                totalSongs,
                totalNonInterludes,
                totalFavorites,
                avgRating,
                topAlbum,
                memoryUsage: ((JSON.stringify(albums).length / 1024) / 1024).toFixed(1)
            };
        }

        function showStartupScreen() {
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            const memoryInfo = document.getElementById('memoryInfo');
            const statusInfo = document.getElementById('statusInfo');
            
            display.innerHTML = `DOME'S MUSIC ARCHIVE<br>MD-3000 PRO READY<br><br>LOADED: ${albums.length} ALBUMS<br>SONGS: ${statsData.totalSongs}<br><br>PRESS SELECT TO START<span class="cursor"></span>`;
            counter.textContent = 'OK';
            counterLabel.textContent = 'SYSTEM READY';
            memoryInfo.textContent = `MEMORY: ${statsData.memoryUsage}MB`;
            statusInfo.textContent = 'STATUS: READY';
            
            currentView = 'startup';
        }

        function showMenu() {
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            
            const item = menuItems[currentMenuIndex];
            
            display.innerHTML = `MAIN MENU<br><br>>${item.name}<br><br>PREV/NEXT: NAVIGATE<br>SELECT: ENTER MODE<span class="cursor"></span>`;
            counter.textContent = `${(currentMenuIndex + 1).toString().padStart(2, '0')}/${menuItems.length.toString().padStart(2, '0')}`;
            counterLabel.textContent = 'MENU SELECT';
            
            currentView = 'menu';
        }

        function showBrowse() {
            if (albums.length === 0) return;
            
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            
            const album = albums[currentIndex];
            
            display.innerHTML = `ALBUM ${(currentIndex + 1).toString().padStart(2, '0')}<br>${album.artist}<br>${album.album} (${album.year})<br><br>RATING: ${album.avgRating}/10<br>TRACKS: ${album.songs.length}<span class="cursor"></span>`;
            counter.textContent = `${(currentIndex + 1).toString().padStart(2, '0')}/${albums.length.toString().padStart(2, '0')}`;
            counterLabel.textContent = 'BROWSE MODE';
            
            currentView = 'browse';
        }

        function showAlbum() {
            const album = albums[currentAlbumIndex];
            const song = album.songs[currentSongIndex];
            
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            
            display.innerHTML = `${album.artist}<br>${album.album}<br><br>TRACK ${(currentSongIndex + 1).toString().padStart(2, '0')}: ${song.name}<br>RATING: ${song.rating}/10<br>${song.favorite ? '★ FAVORITE' : ''}${song.interlude ? ' [INTERLUDE]' : ''}<span class="cursor"></span>`;
            counter.textContent = `T${(currentSongIndex + 1).toString().padStart(2, '0')}/${album.songs.length.toString().padStart(2, '0')}`;
            counterLabel.textContent = 'ALBUM VIEW';
            
            currentView = 'album';
        }

        function showStats() {
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            
            display.innerHTML = `STATISTICS<br><br>ALBUMS: ${statsData.totalAlbums}<br>SONGS: ${statsData.totalNonInterludes}<br>FAVORITES: ${statsData.totalFavorites}<br>AVG RATING: ${statsData.avgRating}/10<span class="cursor"></span>`;
            counter.textContent = statsData.totalAlbums.toString().padStart(2, '0');
            counterLabel.textContent = 'STATS MODE';
            
            currentView = 'stats';
        }

        function showFavorites() {
            const favorites = [];
            albums.forEach((album, albumIndex) => {
                album.songs.forEach((song, songIndex) => {
                    if (song.favorite) {
                        favorites.push({
                            artist: album.artist,
                            album: album.album,
                            song: song.name,
                            rating: song.rating,
                            albumIndex,
                            songIndex
                        });
                    }
                });
            });
            
            favorites.sort((a, b) => b.rating - a.rating);
            
            if (favorites.length === 0) {
                const display = document.getElementById('display');
                display.innerHTML = `FAVORITES<br><br>NO FAVORITES FOUND<span class="cursor"></span>`;
                return;
            }
            
            if (currentIndex >= favorites.length) currentIndex = 0;
            
            const fav = favorites[currentIndex];
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            
            display.innerHTML = `FAVORITE ${(currentIndex + 1).toString().padStart(2, '0')}<br>${fav.artist}<br>${fav.song}<br><br>RATING: ${fav.rating}/10<br>FROM: ${fav.album}<span class="cursor"></span>`;
            counter.textContent = `${(currentIndex + 1).toString().padStart(2, '0')}/${favorites.length.toString().padStart(2, '0')}`;
            counterLabel.textContent = 'FAVORITES';
            
            currentView = 'favorites';
        }

        function showRandom() {
            const randomIndex = Math.floor(Math.random() * albums.length);
            currentIndex = randomIndex;
            currentAlbumIndex = randomIndex;
            showAlbum();
        }

        function showInfo() {
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            
            display.innerHTML = `SYSTEM INFO<br><br>TECHNICS MD-3000 PRO<br>FIRMWARE: V2.1.0<br>MEMORY: ${statsData.memoryUsage}MB<br>STATUS: OPERATIONAL<span class="cursor"></span>`;
            counter.textContent = 'SYS';
            counterLabel.textContent = 'SYSTEM INFO';
            
            currentView = 'info';
        }

        function showError(message) {
            const display = document.getElementById('display');
            const counter = document.getElementById('counter');
            const counterLabel = document.getElementById('counterLabel');
            const statusInfo = document.getElementById('statusInfo');
            
            display.innerHTML = `<div class="error-text">ERROR<br><br>${message}<br><br>CHECK albums.json<br>IN SAME DIRECTORY</div><span class="cursor"></span>`;
            counter.textContent = 'ERR';
            counterLabel.textContent = 'ERROR STATE';
            statusInfo.textContent = 'STATUS: ERROR';
            
            currentView = 'error';
        }

        function navigate(direction) {
            switch(direction) {
                case 'prev':
                    handlePrev();
                    break;
                case 'next':
                    handleNext();
                    break;
                case 'select':
                    handleSelect();
                    break;
            }
            updateButtonLabels();
        }

        function handlePrev() {
            switch(currentView) {
                case 'menu':
                    currentMenuIndex = (currentMenuIndex - 1 + menuItems.length) % menuItems.length;
                    showMenu();
                    break;
                case 'browse':
                    currentIndex = (currentIndex - 1 + albums.length) % albums.length;
                    showBrowse();
                    break;
                case 'album':
                    const album = albums[currentAlbumIndex];
                    currentSongIndex = (currentSongIndex - 1 + album.songs.length) % album.songs.length;
                    showAlbum();
                    break;
                case 'favorites':
                    const favorites = getAllFavorites();
                    if (favorites.length > 0) {
                        currentIndex = (currentIndex - 1 + favorites.length) % favorites.length;
                        showFavorites();
                    }
                    break;
            }
        }

        function handleNext() {
            switch(currentView) {
                case 'menu':
                    currentMenuIndex = (currentMenuIndex + 1) % menuItems.length;
                    showMenu();
                    break;
                case 'browse':
                    currentIndex = (currentIndex + 1) % albums.length;
                    showBrowse();
                    break;
                case 'album':
                    const album = albums[currentAlbumIndex];
                    currentSongIndex = (currentSongIndex + 1) % album.songs.length;
                    showAlbum();
                    break;
                case 'favorites':
                    const favorites = getAllFavorites();
                    if (favorites.length > 0) {
                        currentIndex = (currentIndex + 1) % favorites.length;
                        showFavorites();
                    }
                    break;
            }
        }

        function handleSelect() {
            switch(currentView) {
                case 'startup':
                    currentMenuIndex = 0;
                    showMenu();
                    break;
                case 'menu':
                    const selectedItem = menuItems[currentMenuIndex];
                    switch(selectedItem.mode) {
                        case 'browse':
                            currentIndex = 0;
                            showBrowse();
                            break;
                        case 'stats':
                            showStats();
                            break;
                        case 'favorites':
                            currentIndex = 0;
                            showFavorites();
                            break;
                        case 'random':
                            showRandom();
                            break;
                        case 'info':
                            showInfo();
                            break;
                    }
                    break;
                case 'browse':
                    currentAlbumIndex = currentIndex;
                    currentSongIndex = 0;
                    showAlbum();
                    break;
                case 'album':
                    showBrowse();
                    break;
                case 'stats':
                case 'favorites':
                case 'info':
                    showMenu();
                    break;
                case 'error':
                    // Retry loading
                    loadAlbums();
                    break;
            }
        }

        function getAllFavorites() {
            const favorites = [];
            albums.forEach((album, albumIndex) => {
                album.songs.forEach((song, songIndex) => {
                    if (song.favorite) {
                        favorites.push({
                            artist: album.artist,
                            album: album.album,
                            song: song.name,
                            rating: song.rating,
                            albumIndex,
                            songIndex
                        });
                    }
                });
            });
            return favorites.sort((a, b) => b.rating - a.rating);
        }

        function updateButtonLabels() {
            const btnPrev = document.getElementById('btnPrev');
            const btnSelect = document.getElementById('btnSelect');
            const btnNext = document.getElementById('btnNext');
            
            switch(currentView) {
                case 'startup':
                    btnPrev.textContent = '◀ PREV';
                    btnSelect.textContent = 'START';
                    btnNext.textContent = 'NEXT ▶';
                    break;
                case 'menu':
                    btnPrev.textContent = '◀ UP';
                    btnSelect.textContent = 'ENTER';
                    btnNext.textContent = 'DOWN ▶';
                    break;
                case 'browse':
                    btnPrev.textContent = '◀ PREV';
                    btnSelect.textContent = 'OPEN';
                    btnNext.textContent = 'NEXT ▶';
                    break;
                case 'album':
                    btnPrev.textContent = '◀ TRACK';
                    btnSelect.textContent = 'BACK';
                    btnNext.textContent = 'TRACK ▶';
                    break;
                case 'stats':
                case 'favorites':
                case 'info':
                    btnPrev.textContent = '◀ PREV';
                    btnSelect.textContent = 'MENU';
                    btnNext.textContent = 'NEXT ▶';
                    break;
                case 'error':
                    btnPrev.textContent = '◀ PREV';
                    btnSelect.textContent = 'RETRY';
                    btnNext.textContent = 'NEXT ▶';
                    break;
                default:
                    btnPrev.textContent = '◀ PREV';
                    btnSelect.textContent = 'SELECT';
                    btnNext.textContent = 'NEXT ▶';
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                    navigate('prev');
                    break;
                case 'ArrowRight':
                    navigate('next');
                    break;
                case 'Enter':
                case ' ':
                    navigate('select');
                    break;
                case 'Escape':
                    if (currentView !== 'startup' && currentView !== 'menu') {
                        showMenu();
                    }
                    break;
            }
        });

        // Initialisierung
        setTimeout(() => {
            loadAlbums();
        }, 2000);
    </script>
</body>
</html>
